<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Scenario I: large effect, point prior | Validation Report for adoptr package</title>
  <meta name="description" content="This is an automatically generated validation report for the adoptr R package published via bookdown." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Scenario I: large effect, point prior | Validation Report for adoptr package" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is an automatically generated validation report for the adoptr R package published via bookdown." />
  <meta name="github-repo" content="kkmann/adoptr-validation-report" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Scenario I: large effect, point prior | Validation Report for adoptr package" />
  
  <meta name="twitter:description" content="This is an automatically generated validation report for the adoptr R package published via bookdown." />
  

<meta name="author" content="Kevin Kunzmann &amp; Maximilian Pilz" />


<meta name="date" content="2019-12-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="scenarioII.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Validation Report for adoptr Package</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#preliminaries"><i class="fa fa-check"></i><b>1.1</b> Preliminaries</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#scope"><i class="fa fa-check"></i><b>1.2</b> Scope</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#validating-a-local-installation-of-adoptr"><i class="fa fa-check"></i><b>1.2.1</b> Validating a local installation of adoptr</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#validation-scenarios"><i class="fa fa-check"></i><b>1.3</b> Validation Scenarios</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#scenario-i-large-effect-point-prior"><i class="fa fa-check"></i><b>1.3.1</b> <a href="scenarioI.html#scenarioI">Scenario I: Large effect, point prior</a></a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#scenario-ii-large-effect-gaussian-prior"><i class="fa fa-check"></i><b>1.3.2</b> <a href="scenarioII.html#scenarioII">Scenario II: Large effect, Gaussian prior</a></a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#scenario-iii-large-effect-uniform-prior"><i class="fa fa-check"></i><b>1.3.3</b> <a href="scenarioIII.html#scenarioIII">Scenario III: Large effect, uniform prior</a></a></li>
<li class="chapter" data-level="1.3.4" data-path="index.html"><a href="index.html#scenario-iv-smaller-effect-size-larger-trials"><i class="fa fa-check"></i><b>1.3.4</b> <a href="scenarioIV.html#scenarioIV">Scenario IV: Smaller effect size, larger trials</a></a></li>
<li class="chapter" data-level="1.3.5" data-path="index.html"><a href="index.html#scenario-v-single-arm-design-medium-effect-size"><i class="fa fa-check"></i><b>1.3.5</b> <a href="scenarioV.html#scenarioV">Scenario V: Single-arm design, medium effect size</a></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#technical-setup"><i class="fa fa-check"></i><b>1.4</b> Technical Setup</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="scenarioI.html"><a href="scenarioI.html"><i class="fa fa-check"></i><b>2</b> Scenario I: large effect, point prior</a><ul>
<li class="chapter" data-level="2.1" data-path="scenarioI.html"><a href="scenarioI.html#details"><i class="fa fa-check"></i><b>2.1</b> Details</a></li>
<li class="chapter" data-level="2.2" data-path="scenarioI.html"><a href="scenarioI.html#variantI_1"><i class="fa fa-check"></i><b>2.2</b> Variant I-1: Minimizing Expected Sample Size under Point Prior</a><ul>
<li class="chapter" data-level="2.2.1" data-path="scenarioI.html"><a href="scenarioI.html#objective"><i class="fa fa-check"></i><b>2.2.1</b> Objective</a></li>
<li class="chapter" data-level="2.2.2" data-path="scenarioI.html"><a href="scenarioI.html#constraints"><i class="fa fa-check"></i><b>2.2.2</b> Constraints</a></li>
<li class="chapter" data-level="2.2.3" data-path="scenarioI.html"><a href="scenarioI.html#initial-designs"><i class="fa fa-check"></i><b>2.2.3</b> Initial Designs</a></li>
<li class="chapter" data-level="2.2.4" data-path="scenarioI.html"><a href="scenarioI.html#optimization"><i class="fa fa-check"></i><b>2.2.4</b> Optimization</a></li>
<li class="chapter" data-level="2.2.5" data-path="scenarioI.html"><a href="scenarioI.html#test-cases"><i class="fa fa-check"></i><b>2.2.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="scenarioI.html"><a href="scenarioI.html#variantI_2"><i class="fa fa-check"></i><b>2.3</b> Variant I-2: Minimizing Expected Sample Size under Null Hypothesis</a><ul>
<li class="chapter" data-level="2.3.1" data-path="scenarioI.html"><a href="scenarioI.html#objective-1"><i class="fa fa-check"></i><b>2.3.1</b> Objective</a></li>
<li class="chapter" data-level="2.3.2" data-path="scenarioI.html"><a href="scenarioI.html#constraints-1"><i class="fa fa-check"></i><b>2.3.2</b> Constraints</a></li>
<li class="chapter" data-level="2.3.3" data-path="scenarioI.html"><a href="scenarioI.html#initial-design"><i class="fa fa-check"></i><b>2.3.3</b> Initial Design</a></li>
<li class="chapter" data-level="2.3.4" data-path="scenarioI.html"><a href="scenarioI.html#optimization-1"><i class="fa fa-check"></i><b>2.3.4</b> Optimization</a></li>
<li class="chapter" data-level="2.3.5" data-path="scenarioI.html"><a href="scenarioI.html#test-cases-1"><i class="fa fa-check"></i><b>2.3.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="scenarioI.html"><a href="scenarioI.html#variantI_3"><i class="fa fa-check"></i><b>2.4</b> Variant I-3: Conditional Power Constraint</a><ul>
<li class="chapter" data-level="2.4.1" data-path="scenarioI.html"><a href="scenarioI.html#objective-2"><i class="fa fa-check"></i><b>2.4.1</b> Objective</a></li>
<li class="chapter" data-level="2.4.2" data-path="scenarioI.html"><a href="scenarioI.html#constraints-2"><i class="fa fa-check"></i><b>2.4.2</b> Constraints</a></li>
<li class="chapter" data-level="2.4.3" data-path="scenarioI.html"><a href="scenarioI.html#initial-design-1"><i class="fa fa-check"></i><b>2.4.3</b> Initial Design</a></li>
<li class="chapter" data-level="2.4.4" data-path="scenarioI.html"><a href="scenarioI.html#optimization-2"><i class="fa fa-check"></i><b>2.4.4</b> Optimization</a></li>
<li class="chapter" data-level="2.4.5" data-path="scenarioI.html"><a href="scenarioI.html#test-cases-2"><i class="fa fa-check"></i><b>2.4.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="scenarioI.html"><a href="scenarioI.html#plot-two-stage-designs"><i class="fa fa-check"></i><b>2.5</b> Plot Two-Stage Designs</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="scenarioII.html"><a href="scenarioII.html"><i class="fa fa-check"></i><b>3</b> Scenario II: large effect, Gaussian prior</a><ul>
<li class="chapter" data-level="3.1" data-path="scenarioII.html"><a href="scenarioII.html#details-1"><i class="fa fa-check"></i><b>3.1</b> Details</a></li>
<li class="chapter" data-level="3.2" data-path="scenarioII.html"><a href="scenarioII.html#variantII_1"><i class="fa fa-check"></i><b>3.2</b> Variant II-1: Minimizing Expected Sample Size under Point Prior</a><ul>
<li class="chapter" data-level="3.2.1" data-path="scenarioII.html"><a href="scenarioII.html#objective-3"><i class="fa fa-check"></i><b>3.2.1</b> Objective</a></li>
<li class="chapter" data-level="3.2.2" data-path="scenarioII.html"><a href="scenarioII.html#constraints-3"><i class="fa fa-check"></i><b>3.2.2</b> Constraints</a></li>
<li class="chapter" data-level="3.2.3" data-path="scenarioII.html"><a href="scenarioII.html#initial-design-2"><i class="fa fa-check"></i><b>3.2.3</b> Initial Design</a></li>
<li class="chapter" data-level="3.2.4" data-path="scenarioII.html"><a href="scenarioII.html#optimization-3"><i class="fa fa-check"></i><b>3.2.4</b> Optimization</a></li>
<li class="chapter" data-level="3.2.5" data-path="scenarioII.html"><a href="scenarioII.html#test-cases-3"><i class="fa fa-check"></i><b>3.2.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="scenarioII.html"><a href="scenarioII.html#variantII_2"><i class="fa fa-check"></i><b>3.3</b> Variant II-2: Minimizing Expected Sample Size under Null Hypothesis</a><ul>
<li class="chapter" data-level="3.3.1" data-path="scenarioII.html"><a href="scenarioII.html#objective-4"><i class="fa fa-check"></i><b>3.3.1</b> Objective</a></li>
<li class="chapter" data-level="3.3.2" data-path="scenarioII.html"><a href="scenarioII.html#constraints-4"><i class="fa fa-check"></i><b>3.3.2</b> Constraints</a></li>
<li class="chapter" data-level="3.3.3" data-path="scenarioII.html"><a href="scenarioII.html#initial-design-3"><i class="fa fa-check"></i><b>3.3.3</b> Initial Design</a></li>
<li class="chapter" data-level="3.3.4" data-path="scenarioII.html"><a href="scenarioII.html#optimization-4"><i class="fa fa-check"></i><b>3.3.4</b> Optimization</a></li>
<li class="chapter" data-level="3.3.5" data-path="scenarioII.html"><a href="scenarioII.html#test-cases-4"><i class="fa fa-check"></i><b>3.3.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="scenarioII.html"><a href="scenarioII.html#variantII_3"><i class="fa fa-check"></i><b>3.4</b> Variant II-3: Conditional Power Constraint</a><ul>
<li class="chapter" data-level="3.4.1" data-path="scenarioII.html"><a href="scenarioII.html#objective-5"><i class="fa fa-check"></i><b>3.4.1</b> Objective</a></li>
<li class="chapter" data-level="3.4.2" data-path="scenarioII.html"><a href="scenarioII.html#constraints-5"><i class="fa fa-check"></i><b>3.4.2</b> Constraints</a></li>
<li class="chapter" data-level="3.4.3" data-path="scenarioII.html"><a href="scenarioII.html#initial-design-4"><i class="fa fa-check"></i><b>3.4.3</b> Initial Design</a></li>
<li class="chapter" data-level="3.4.4" data-path="scenarioII.html"><a href="scenarioII.html#optimization-5"><i class="fa fa-check"></i><b>3.4.4</b> Optimization</a></li>
<li class="chapter" data-level="3.4.5" data-path="scenarioII.html"><a href="scenarioII.html#test-cases-5"><i class="fa fa-check"></i><b>3.4.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="scenarioII.html"><a href="scenarioII.html#plot-two-stage-designs-1"><i class="fa fa-check"></i><b>3.5</b> Plot Two-Stage Designs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="scenarioIII.html"><a href="scenarioIII.html"><i class="fa fa-check"></i><b>4</b> Scenario III: large effect, uniform prior</a><ul>
<li class="chapter" data-level="4.1" data-path="scenarioIII.html"><a href="scenarioIII.html#details-2"><i class="fa fa-check"></i><b>4.1</b> Details</a></li>
<li class="chapter" data-level="4.2" data-path="scenarioIII.html"><a href="scenarioIII.html#variantIII_1"><i class="fa fa-check"></i><b>4.2</b> Variant III.1: Convergence under prior concentration</a><ul>
<li class="chapter" data-level="4.2.1" data-path="scenarioIII.html"><a href="scenarioIII.html#objective-6"><i class="fa fa-check"></i><b>4.2.1</b> Objective</a></li>
<li class="chapter" data-level="4.2.2" data-path="scenarioIII.html"><a href="scenarioIII.html#constraints-6"><i class="fa fa-check"></i><b>4.2.2</b> Constraints</a></li>
<li class="chapter" data-level="4.2.3" data-path="scenarioIII.html"><a href="scenarioIII.html#optimization-problem"><i class="fa fa-check"></i><b>4.2.3</b> Optimization problem</a></li>
<li class="chapter" data-level="4.2.4" data-path="scenarioIII.html"><a href="scenarioIII.html#test-cases-6"><i class="fa fa-check"></i><b>4.2.4</b> Test cases</a></li>
<li class="chapter" data-level="4.2.5" data-path="scenarioIII.html"><a href="scenarioIII.html#plot-designs"><i class="fa fa-check"></i><b>4.2.5</b> Plot designs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="scenarioIV.html"><a href="scenarioIV.html"><i class="fa fa-check"></i><b>5</b> Scenario IV: smaller effect, point prior</a><ul>
<li class="chapter" data-level="5.1" data-path="scenarioIV.html"><a href="scenarioIV.html#details-3"><i class="fa fa-check"></i><b>5.1</b> Details</a></li>
<li class="chapter" data-level="5.2" data-path="scenarioIV.html"><a href="scenarioIV.html#variantIV_1"><i class="fa fa-check"></i><b>5.2</b> Variant IV-1: Minimizing Expected Sample Size under Point Prior</a><ul>
<li class="chapter" data-level="5.2.1" data-path="scenarioIV.html"><a href="scenarioIV.html#objective-7"><i class="fa fa-check"></i><b>5.2.1</b> Objective</a></li>
<li class="chapter" data-level="5.2.2" data-path="scenarioIV.html"><a href="scenarioIV.html#constraints-7"><i class="fa fa-check"></i><b>5.2.2</b> Constraints</a></li>
<li class="chapter" data-level="5.2.3" data-path="scenarioIV.html"><a href="scenarioIV.html#initial-design-5"><i class="fa fa-check"></i><b>5.2.3</b> Initial Design</a></li>
<li class="chapter" data-level="5.2.4" data-path="scenarioIV.html"><a href="scenarioIV.html#optimization-6"><i class="fa fa-check"></i><b>5.2.4</b> Optimization</a></li>
<li class="chapter" data-level="5.2.5" data-path="scenarioIV.html"><a href="scenarioIV.html#test-cases-7"><i class="fa fa-check"></i><b>5.2.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="scenarioIV.html"><a href="scenarioIV.html#variantIV_2"><i class="fa fa-check"></i><b>5.3</b> Variant IV-2: Increase Power</a><ul>
<li class="chapter" data-level="5.3.1" data-path="scenarioIV.html"><a href="scenarioIV.html#objective-8"><i class="fa fa-check"></i><b>5.3.1</b> Objective</a></li>
<li class="chapter" data-level="5.3.2" data-path="scenarioIV.html"><a href="scenarioIV.html#constraints-8"><i class="fa fa-check"></i><b>5.3.2</b> Constraints</a></li>
<li class="chapter" data-level="5.3.3" data-path="scenarioIV.html"><a href="scenarioIV.html#initial-design-6"><i class="fa fa-check"></i><b>5.3.3</b> Initial Design</a></li>
<li class="chapter" data-level="5.3.4" data-path="scenarioIV.html"><a href="scenarioIV.html#optimization-7"><i class="fa fa-check"></i><b>5.3.4</b> Optimization</a></li>
<li class="chapter" data-level="5.3.5" data-path="scenarioIV.html"><a href="scenarioIV.html#test-cases-8"><i class="fa fa-check"></i><b>5.3.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="scenarioIV.html"><a href="scenarioIV.html#variantIV_3"><i class="fa fa-check"></i><b>5.4</b> Variant IV-3: Increase Type One Error rate</a><ul>
<li class="chapter" data-level="5.4.1" data-path="scenarioIV.html"><a href="scenarioIV.html#objective-9"><i class="fa fa-check"></i><b>5.4.1</b> Objective</a></li>
<li class="chapter" data-level="5.4.2" data-path="scenarioIV.html"><a href="scenarioIV.html#constraints-9"><i class="fa fa-check"></i><b>5.4.2</b> Constraints</a></li>
<li class="chapter" data-level="5.4.3" data-path="scenarioIV.html"><a href="scenarioIV.html#initial-design-7"><i class="fa fa-check"></i><b>5.4.3</b> Initial Design</a></li>
<li class="chapter" data-level="5.4.4" data-path="scenarioIV.html"><a href="scenarioIV.html#optimization-8"><i class="fa fa-check"></i><b>5.4.4</b> Optimization</a></li>
<li class="chapter" data-level="5.4.5" data-path="scenarioIV.html"><a href="scenarioIV.html#test-cases-9"><i class="fa fa-check"></i><b>5.4.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="scenarioIV.html"><a href="scenarioIV.html#plot-two-stage-designs-2"><i class="fa fa-check"></i><b>5.5</b> Plot Two-Stage Designs</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="scenarioV.html"><a href="scenarioV.html"><i class="fa fa-check"></i><b>6</b> Scenario V: single-arm design, medium effect size</a><ul>
<li class="chapter" data-level="6.1" data-path="scenarioV.html"><a href="scenarioV.html#details-4"><i class="fa fa-check"></i><b>6.1</b> Details</a></li>
<li class="chapter" data-level="6.2" data-path="scenarioV.html"><a href="scenarioV.html#variantV_1"><i class="fa fa-check"></i><b>6.2</b> Variant V-1, sensitivity to integration order</a><ul>
<li class="chapter" data-level="6.2.1" data-path="scenarioV.html"><a href="scenarioV.html#objective-10"><i class="fa fa-check"></i><b>6.2.1</b> Objective</a></li>
<li class="chapter" data-level="6.2.2" data-path="scenarioV.html"><a href="scenarioV.html#constraints-10"><i class="fa fa-check"></i><b>6.2.2</b> Constraints</a></li>
<li class="chapter" data-level="6.2.3" data-path="scenarioV.html"><a href="scenarioV.html#initial-design-8"><i class="fa fa-check"></i><b>6.2.3</b> Initial Design</a></li>
<li class="chapter" data-level="6.2.4" data-path="scenarioV.html"><a href="scenarioV.html#optimization-9"><i class="fa fa-check"></i><b>6.2.4</b> Optimization</a></li>
<li class="chapter" data-level="6.2.5" data-path="scenarioV.html"><a href="scenarioV.html#test-cases-10"><i class="fa fa-check"></i><b>6.2.5</b> Test cases</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="scenarioV.html"><a href="scenarioV.html#variantV_2"><i class="fa fa-check"></i><b>6.3</b> Variant V-2, utility maximization</a><ul>
<li class="chapter" data-level="6.3.1" data-path="scenarioV.html"><a href="scenarioV.html#objective-11"><i class="fa fa-check"></i><b>6.3.1</b> Objective</a></li>
<li class="chapter" data-level="6.3.2" data-path="scenarioV.html"><a href="scenarioV.html#constraints-11"><i class="fa fa-check"></i><b>6.3.2</b> Constraints</a></li>
<li class="chapter" data-level="6.3.3" data-path="scenarioV.html"><a href="scenarioV.html#initial-design-9"><i class="fa fa-check"></i><b>6.3.3</b> Initial Design</a></li>
<li class="chapter" data-level="6.3.4" data-path="scenarioV.html"><a href="scenarioV.html#optimization-10"><i class="fa fa-check"></i><b>6.3.4</b> Optimization</a></li>
<li class="chapter" data-level="6.3.5" data-path="scenarioV.html"><a href="scenarioV.html#test-cases-11"><i class="fa fa-check"></i><b>6.3.5</b> Test cases</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="scenarioV.html"><a href="scenarioV.html#variantV_3"><i class="fa fa-check"></i><b>6.4</b> Variant V-3, n1-penalty</a><ul>
<li class="chapter" data-level="6.4.1" data-path="scenarioV.html"><a href="scenarioV.html#objective-12"><i class="fa fa-check"></i><b>6.4.1</b> Objective</a></li>
<li class="chapter" data-level="6.4.2" data-path="scenarioV.html"><a href="scenarioV.html#constraints-12"><i class="fa fa-check"></i><b>6.4.2</b> Constraints</a></li>
<li class="chapter" data-level="6.4.3" data-path="scenarioV.html"><a href="scenarioV.html#initial-design-10"><i class="fa fa-check"></i><b>6.4.3</b> Initial Design</a></li>
<li class="chapter" data-level="6.4.4" data-path="scenarioV.html"><a href="scenarioV.html#optimization-11"><i class="fa fa-check"></i><b>6.4.4</b> Optimization</a></li>
<li class="chapter" data-level="6.4.5" data-path="scenarioV.html"><a href="scenarioV.html#test-cases-12"><i class="fa fa-check"></i><b>6.4.5</b> Test cases</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="scenarioV.html"><a href="scenarioV.html#variantV_4"><i class="fa fa-check"></i><b>6.5</b> Variant V-4, n2-penalty</a><ul>
<li class="chapter" data-level="6.5.1" data-path="scenarioV.html"><a href="scenarioV.html#objective-13"><i class="fa fa-check"></i><b>6.5.1</b> Objective</a></li>
<li class="chapter" data-level="6.5.2" data-path="scenarioV.html"><a href="scenarioV.html#constraints-13"><i class="fa fa-check"></i><b>6.5.2</b> Constraints</a></li>
<li class="chapter" data-level="6.5.3" data-path="scenarioV.html"><a href="scenarioV.html#initial-design-11"><i class="fa fa-check"></i><b>6.5.3</b> Initial Design</a></li>
<li class="chapter" data-level="6.5.4" data-path="scenarioV.html"><a href="scenarioV.html#optimization-12"><i class="fa fa-check"></i><b>6.5.4</b> Optimization</a></li>
<li class="chapter" data-level="6.5.5" data-path="scenarioV.html"><a href="scenarioV.html#test-cases-13"><i class="fa fa-check"></i><b>6.5.5</b> Test cases</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Validation Report for <strong>adoptr</strong> package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="scenarioI" class="section level1">
<h1><span class="header-section-number">2</span> Scenario I: large effect, point prior</h1>
<div id="details" class="section level2">
<h2><span class="header-section-number">2.1</span> Details</h2>
<p>In this scenario, a classical two-arm trial with normal
test statistic and known variance (w.l.o.g. variance of
the test statistic is 1).
This situation corresponds to a classical <span class="math inline">\(z\)</span>-test for
a difference in population means.
The null hypothesis is no population mean difference, i.e.
<span class="math inline">\(\mathcal{H}_0:\delta \leq 0\)</span>.
An alternative effect size of <span class="math inline">\(\delta = 0.4\)</span> with
point prior distribution is assumed.
Across all variants in this scenario, the one-sided maximal
type one error rate is restricted to <span class="math inline">\(\alpha=0.025\)</span>
and the power at the point alternative of <span class="math inline">\(\delta=0.4\)</span> must
be at least <span class="math inline">\(0.8\)</span>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># data distribution and hypotheses</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">datadist   &lt;-<span class="st"> </span><span class="kw">Normal</span>(<span class="dt">two_armed =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">H_<span class="dv">0</span>        &lt;-<span class="st"> </span><span class="kw">PointMassPrior</span>(.<span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">prior      &lt;-<span class="st"> </span><span class="kw">PointMassPrior</span>(.<span class="dv">4</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb21-5" data-line-number="5"></a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="co"># define constraints</span></a>
<a class="sourceLine" id="cb21-7" data-line-number="7">alpha      &lt;-<span class="st"> </span><span class="fl">0.025</span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8">min_power  &lt;-<span class="st"> </span><span class="fl">0.8</span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9">toer_cnstr &lt;-<span class="st"> </span><span class="kw">Power</span>(datadist, H_<span class="dv">0</span>)   <span class="op">&lt;=</span><span class="st"> </span>alpha</a>
<a class="sourceLine" id="cb21-10" data-line-number="10">pow_cnstr  &lt;-<span class="st"> </span><span class="kw">Power</span>(datadist, prior) <span class="op">&gt;=</span><span class="st"> </span>min_power</a></code></pre></div>
</div>
<div id="variantI_1" class="section level2">
<h2><span class="header-section-number">2.2</span> Variant I-1: Minimizing Expected Sample Size under Point Prior</h2>
<div id="objective" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Objective</h3>
<p>Firstly, expected sample size under the alternative (point prior)
is minimized, i.e.,
<span class="math inline">\(\boldsymbol{E}\big[n(\mathcal{D})\big]\)</span>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">ess &lt;-<span class="st"> </span><span class="kw">ExpectedSampleSize</span>(datadist, prior)</a></code></pre></div>
</div>
<div id="constraints" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Constraints</h3>
<p>No additional constraints besides type one error rate and power
are considered in this variant.</p>
</div>
<div id="initial-designs" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Initial Designs</h3>
<p>For this example, the optimal one-stage, group-sequential, and generic
two-stage designs are computed.
The initial design for the one-stage case is determined heuristically
(cf. <a href="scenarioIII.html#scenarioIII">Scenario III</a> where another initial design is applied
on the same situation for stability of initial values).
Both the group sequential and the generic two-stage designs are
optimized starting from the corresponding group-sequential design as
computed by the <code>rpact</code> package.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">order &lt;-<span class="st"> </span>7L</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="co"># data frame of initial designs </span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3">tbl_designs &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">    <span class="dt">type    =</span> <span class="kw">c</span>(<span class="st">&quot;one-stage&quot;</span>, <span class="st">&quot;group-sequential&quot;</span>, <span class="st">&quot;two-stage&quot;</span>),</a>
<a class="sourceLine" id="cb23-5" data-line-number="5">    <span class="dt">initial =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb23-6" data-line-number="6">        <span class="kw">OneStageDesign</span>(<span class="dv">200</span>, <span class="fl">2.0</span>),</a>
<a class="sourceLine" id="cb23-7" data-line-number="7">        <span class="kw">rpact_design</span>(<span class="fl">0.4</span>, <span class="fl">0.025</span>, <span class="fl">0.8</span>, <span class="ot">TRUE</span>, order),</a>
<a class="sourceLine" id="cb23-8" data-line-number="8">        <span class="kw">TwoStageDesign</span>(<span class="kw">rpact_design</span>(<span class="fl">0.4</span>, <span class="fl">0.025</span>, <span class="fl">0.8</span>, <span class="ot">TRUE</span>, order))) )</a></code></pre></div>
<p>The order of integration is set to 7.</p>
</div>
<div id="optimization" class="section level3">
<h3><span class="header-section-number">2.2.4</span> Optimization</h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">tbl_designs &lt;-<span class="st"> </span>tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">       <span class="dt">optimal =</span> purrr<span class="op">::</span><span class="kw">map</span>(initial, <span class="op">~</span><span class="kw">minimize</span>(</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">         </a>
<a class="sourceLine" id="cb24-5" data-line-number="5">          ess,</a>
<a class="sourceLine" id="cb24-6" data-line-number="6">          <span class="kw">subject_to</span>(</a>
<a class="sourceLine" id="cb24-7" data-line-number="7">              toer_cnstr,</a>
<a class="sourceLine" id="cb24-8" data-line-number="8">              pow_cnstr</a>
<a class="sourceLine" id="cb24-9" data-line-number="9">          ),</a>
<a class="sourceLine" id="cb24-10" data-line-number="10">          </a>
<a class="sourceLine" id="cb24-11" data-line-number="11">          <span class="dt">initial_design =</span> ., </a>
<a class="sourceLine" id="cb24-12" data-line-number="12">          <span class="dt">opts           =</span> opts)) )</a></code></pre></div>
</div>
<div id="test-cases" class="section level3">
<h3><span class="header-section-number">2.2.5</span> Test Cases</h3>
<p>To avoid improper solutions, it is first verified that the maximum
number of iterations was not exceeded in any of the three cases.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">      type, </a>
<a class="sourceLine" id="cb25-4" data-line-number="4">      <span class="dt">iterations =</span> purrr<span class="op">::</span><span class="kw">map_int</span>(tbl_designs<span class="op">$</span>optimal, </a>
<a class="sourceLine" id="cb25-5" data-line-number="5">                                  <span class="op">~</span>.<span class="op">$</span>nloptr_return<span class="op">$</span>iterations) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6"><span class="st">  </span>{<span class="kw">print</span>(.); .} <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-7" data-line-number="7"><span class="st">  </span>{testthat<span class="op">::</span><span class="kw">expect_true</span>(<span class="kw">all</span>(.<span class="op">$</span>iterations <span class="op">&lt;</span><span class="st"> </span>opts<span class="op">$</span>maxeval))}</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   type             iterations
##   &lt;chr&gt;                 &lt;int&gt;
## 1 one-stage                24
## 2 group-sequential       1447
## 3 two-stage              4157</code></pre>
<p>Next, the type one error rate and power constraints are verified
for all three designs by simulation:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">      type, </a>
<a class="sourceLine" id="cb27-4" data-line-number="4">      <span class="dt">toer  =</span> purrr<span class="op">::</span><span class="kw">map</span>(tbl_designs<span class="op">$</span>optimal, </a>
<a class="sourceLine" id="cb27-5" data-line-number="5">                         <span class="op">~</span><span class="kw">sim_pr_reject</span>(.[[<span class="dv">1</span>]], <span class="fl">.0</span>, datadist)<span class="op">$</span>prob), </a>
<a class="sourceLine" id="cb27-6" data-line-number="6">      <span class="dt">power =</span> purrr<span class="op">::</span><span class="kw">map</span>(tbl_designs<span class="op">$</span>optimal, </a>
<a class="sourceLine" id="cb27-7" data-line-number="7">                         <span class="op">~</span><span class="kw">sim_pr_reject</span>(.[[<span class="dv">1</span>]], <span class="fl">.4</span>, datadist)<span class="op">$</span>prob) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="st">  </span><span class="kw">unnest</span>(., <span class="dt">cols =</span> <span class="kw">c</span>(toer, power)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="st">  </span>{<span class="kw">print</span>(.); .} <span class="op">%&gt;%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb27-10" data-line-number="10">  testthat<span class="op">::</span><span class="kw">expect_true</span>(<span class="kw">all</span>(.<span class="op">$</span>toer  <span class="op">&lt;=</span><span class="st"> </span>alpha <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>tol)))</a>
<a class="sourceLine" id="cb27-11" data-line-number="11">  testthat<span class="op">::</span><span class="kw">expect_true</span>(<span class="kw">all</span>(.<span class="op">$</span>power <span class="op">&gt;=</span><span class="st"> </span>min_power <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>tol))) }</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   type               toer power
##   &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;
## 1 one-stage        0.0251 0.799
## 2 group-sequential 0.0250 0.800
## 3 two-stage        0.0250 0.799</code></pre>
<p>The <span class="math inline">\(n_2\)</span> function of the optimal two-stage design is expected to be
monotonously decreasing:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">expect_true</span>(</a>
<a class="sourceLine" id="cb29-2" data-line-number="2">    <span class="kw">all</span>(<span class="kw">diff</span>(</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">        <span class="co"># get optimal two-stage design n2 pivots</span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4">        tbl_designs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;two-stage&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb29-5" data-line-number="5"><span class="st">           </span>{.[[<span class="st">&quot;optimal&quot;</span>]][[<span class="dv">1</span>]]<span class="op">$</span>design<span class="op">@</span>n2_pivots} </a>
<a class="sourceLine" id="cb29-6" data-line-number="6">        ) <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) )</a></code></pre></div>
<p>Since the degrees of freedom of the three design classes are ordered as
‘two-stage’ &gt; ‘group-sequential’ &gt; ‘one-stage’,
the expected sample sizes (under the alternative) should be ordered
in reverse (‘two-stage’ smallest).
Additionally, expected sample sizes under both null and alternative
are computed both via <code>evaluate()</code> and simulation-based.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">ess0 &lt;-<span class="st"> </span><span class="kw">ExpectedSampleSize</span>(datadist, H_<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb30-2" data-line-number="2"></a>
<a class="sourceLine" id="cb30-3" data-line-number="3">tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb30-5" data-line-number="5">        <span class="dt">ess      =</span> <span class="kw">map_dbl</span>(optimal,</a>
<a class="sourceLine" id="cb30-6" data-line-number="6">                           <span class="op">~</span><span class="kw">evaluate</span>(ess, .<span class="op">$</span>design) ),</a>
<a class="sourceLine" id="cb30-7" data-line-number="7">        <span class="dt">ess_sim  =</span> <span class="kw">map_dbl</span>(optimal,</a>
<a class="sourceLine" id="cb30-8" data-line-number="8">                           <span class="op">~</span><span class="kw">sim_n</span>(.<span class="op">$</span>design, <span class="fl">.4</span>, datadist)<span class="op">$</span>n ),</a>
<a class="sourceLine" id="cb30-9" data-line-number="9">        <span class="dt">ess0     =</span> <span class="kw">map_dbl</span>(optimal,</a>
<a class="sourceLine" id="cb30-10" data-line-number="10">                           <span class="op">~</span><span class="kw">evaluate</span>(ess0, .<span class="op">$</span>design) ),</a>
<a class="sourceLine" id="cb30-11" data-line-number="11">        <span class="dt">ess0_sim =</span> <span class="kw">map_dbl</span>(optimal,</a>
<a class="sourceLine" id="cb30-12" data-line-number="12">                           <span class="op">~</span><span class="kw">sim_n</span>(.<span class="op">$</span>design, <span class="fl">.0</span>, datadist)<span class="op">$</span>n ) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb30-13" data-line-number="13"><span class="st">    </span>{<span class="kw">print</span>(.); .} <span class="op">%&gt;%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb30-14" data-line-number="14">    <span class="co"># sim/evaluate same under alternative?</span></a>
<a class="sourceLine" id="cb30-15" data-line-number="15">    testthat<span class="op">::</span><span class="kw">expect_equal</span>(.<span class="op">$</span>ess, .<span class="op">$</span>ess_sim, </a>
<a class="sourceLine" id="cb30-16" data-line-number="16">                           <span class="dt">tolerance =</span> tol_n,</a>
<a class="sourceLine" id="cb30-17" data-line-number="17">                           <span class="dt">scale =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb30-18" data-line-number="18">    <span class="co"># sim/evaluate same under null?</span></a>
<a class="sourceLine" id="cb30-19" data-line-number="19">    testthat<span class="op">::</span><span class="kw">expect_equal</span>(.<span class="op">$</span>ess0, .<span class="op">$</span>ess0_sim, </a>
<a class="sourceLine" id="cb30-20" data-line-number="20">                           <span class="dt">tolerance =</span> tol_n,</a>
<a class="sourceLine" id="cb30-21" data-line-number="21">                           <span class="dt">scale =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb30-22" data-line-number="22">    <span class="co"># monotonicity with respect to degrees of freedom</span></a>
<a class="sourceLine" id="cb30-23" data-line-number="23">    testthat<span class="op">::</span><span class="kw">expect_true</span>(<span class="kw">all</span>(<span class="kw">diff</span>(.<span class="op">$</span>ess) <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)) }</a></code></pre></div>
<pre><code>## # A tibble: 3 x 7
##   type             initial    optimal      ess ess_sim  ess0 ess0_sim
##   &lt;chr&gt;            &lt;list&gt;     &lt;list&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
## 1 one-stage        &lt;OnStgDsg&gt; &lt;adptrOpR&gt;  98      98    98       98  
## 2 group-sequential &lt;GrpSqntD&gt; &lt;adptrOpR&gt;  80.9    80.9  68.5     68.5
## 3 two-stage        &lt;TwStgDsg&gt; &lt;adptrOpR&gt;  79.7    79.7  68.9     68.9</code></pre>
<p>The expected sample size under the alternative must be lower or equal than
the expected sample size of the inital <code>rpact</code> group-sequential design that
is based on the inverse normal combination test.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">testthat<span class="op">::</span><span class="kw">expect_lte</span>(</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">  <span class="kw">evaluate</span>(ess, </a>
<a class="sourceLine" id="cb32-3" data-line-number="3">             tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="st">                </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;group-sequential&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="st">                </span><span class="kw">pull</span>(optimal) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6"><span class="st">                </span>.[[<span class="dv">1</span>]]  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-7" data-line-number="7"><span class="st">                </span>.<span class="op">$</span>design ),</a>
<a class="sourceLine" id="cb32-8" data-line-number="8">    <span class="kw">evaluate</span>(ess, </a>
<a class="sourceLine" id="cb32-9" data-line-number="9">             tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-10" data-line-number="10"><span class="st">                </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;group-sequential&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-11" data-line-number="11"><span class="st">                </span><span class="kw">pull</span>(initial) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-12" data-line-number="12"><span class="st">                </span>.[[<span class="dv">1</span>]] ) )</a></code></pre></div>
</div>
</div>
<div id="variantI_2" class="section level2">
<h2><span class="header-section-number">2.3</span> Variant I-2: Minimizing Expected Sample Size under Null Hypothesis</h2>
<div id="objective-1" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Objective</h3>
<p>Expected sample size under the null hypothesis prior is minimized,
i.e., <code>ess0</code>.</p>
</div>
<div id="constraints-1" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Constraints</h3>
<p>The constraints remain unchanged from the base case.</p>
</div>
<div id="initial-design" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Initial Design</h3>
<p>Since optimization under the null favours an entirely different
(monotonically increasing) sample size function,
and thus also a different shape of the <span class="math inline">\(c_2\)</span> function,
the <code>rpact</code> initial design is a suboptimal starting point.
Instead, we start with a constant <span class="math inline">\(c_2\)</span> function by heuristically
setting it to <span class="math inline">\(2\)</span> on the continuation area.
Also, optimizing under the null favours extremely conservative
boundaries for early efficacy stopping and we thus impose as fairly
liberal upper bound of <span class="math inline">\(3\)</span> for early efficacy stopping.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">init_design_h0 &lt;-<span class="st"> </span>tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="st">    </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;two-stage&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="st">    </span><span class="kw">pull</span>(initial) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="st">    </span>.[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb33-5" data-line-number="5">init_design_h0<span class="op">@</span>c2_pivots &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">2</span>, order)</a>
<a class="sourceLine" id="cb33-6" data-line-number="6"></a>
<a class="sourceLine" id="cb33-7" data-line-number="7">ub_design &lt;-<span class="st"> </span><span class="kw">TwoStageDesign</span>(</a>
<a class="sourceLine" id="cb33-8" data-line-number="8">    <span class="dv">3</span> <span class="op">*</span><span class="st"> </span>init_design_h0<span class="op">@</span>n1,</a>
<a class="sourceLine" id="cb33-9" data-line-number="9">    <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb33-10" data-line-number="10">    <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb33-11" data-line-number="11">    <span class="kw">rep</span>(<span class="dv">300</span>, order),</a>
<a class="sourceLine" id="cb33-12" data-line-number="12">    <span class="kw">rep</span>(<span class="fl">3.0</span>, order)</a>
<a class="sourceLine" id="cb33-13" data-line-number="13">)</a></code></pre></div>
</div>
<div id="optimization-1" class="section level3">
<h3><span class="header-section-number">2.3.4</span> Optimization</h3>
<p>The optimal two-stage design is computed.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">opt_h0 &lt;-<span class="st"> </span><span class="kw">minimize</span>(</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb34-3" data-line-number="3">    ess0,</a>
<a class="sourceLine" id="cb34-4" data-line-number="4">    </a>
<a class="sourceLine" id="cb34-5" data-line-number="5">    <span class="kw">subject_to</span>(</a>
<a class="sourceLine" id="cb34-6" data-line-number="6">        toer_cnstr,</a>
<a class="sourceLine" id="cb34-7" data-line-number="7">        pow_cnstr</a>
<a class="sourceLine" id="cb34-8" data-line-number="8">    ),</a>
<a class="sourceLine" id="cb34-9" data-line-number="9">    </a>
<a class="sourceLine" id="cb34-10" data-line-number="10">    <span class="dt">initial_design        =</span> init_design_h0,</a>
<a class="sourceLine" id="cb34-11" data-line-number="11">    <span class="dt">upper_boundary_design =</span> ub_design,</a>
<a class="sourceLine" id="cb34-12" data-line-number="12">    <span class="dt">opts =</span> opts )</a></code></pre></div>
</div>
<div id="test-cases-1" class="section level3">
<h3><span class="header-section-number">2.3.5</span> Test Cases</h3>
<p>Make sure that the optimization algorithm converged within the set
maximum number of iterations:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">opt_h0<span class="op">$</span>nloptr_return<span class="op">$</span>iterations <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="st">    </span>{<span class="kw">print</span>(.); .} <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="st">    </span>{testthat<span class="op">::</span><span class="kw">expect_true</span>(. <span class="op">&lt;</span><span class="st"> </span>opts<span class="op">$</span>maxeval)}</a></code></pre></div>
<pre><code>## [1] 18911</code></pre>
<p>The <span class="math inline">\(n_2\)</span> function of the optimal two-stage design is expected to be
monotonously increasing.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">expect_true</span>(</a>
<a class="sourceLine" id="cb37-2" data-line-number="2">    <span class="kw">all</span>(<span class="kw">diff</span>(opt_h0<span class="op">$</span>design<span class="op">@</span>n2_pivots) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) )</a></code></pre></div>
<p>Next, the type one error rate and power constraints are tested.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">tbl_performance &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">    <span class="dt">delta =</span> <span class="kw">c</span>(.<span class="dv">0</span>, <span class="fl">.4</span>) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb38-3" data-line-number="3"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb38-4" data-line-number="4">        <span class="dt">power     =</span> <span class="kw">map</span>(</a>
<a class="sourceLine" id="cb38-5" data-line-number="5">            delta, </a>
<a class="sourceLine" id="cb38-6" data-line-number="6">            <span class="op">~</span><span class="kw">evaluate</span>(</a>
<a class="sourceLine" id="cb38-7" data-line-number="7">                <span class="kw">Power</span>(datadist, <span class="kw">PointMassPrior</span>(., <span class="dv">1</span>)), </a>
<a class="sourceLine" id="cb38-8" data-line-number="8">                opt_h0<span class="op">$</span>design) ),</a>
<a class="sourceLine" id="cb38-9" data-line-number="9">        <span class="dt">power_sim =</span> <span class="kw">map</span>(</a>
<a class="sourceLine" id="cb38-10" data-line-number="10">            delta, </a>
<a class="sourceLine" id="cb38-11" data-line-number="11">            <span class="op">~</span><span class="kw">sim_pr_reject</span>(opt_h0<span class="op">$</span>design, ., datadist)<span class="op">$</span>prob),</a>
<a class="sourceLine" id="cb38-12" data-line-number="12">        <span class="dt">ess       =</span> <span class="kw">map</span>(</a>
<a class="sourceLine" id="cb38-13" data-line-number="13">            delta, </a>
<a class="sourceLine" id="cb38-14" data-line-number="14">            <span class="op">~</span><span class="kw">evaluate</span>(<span class="kw">ExpectedSampleSize</span>(</a>
<a class="sourceLine" id="cb38-15" data-line-number="15">                    datadist, </a>
<a class="sourceLine" id="cb38-16" data-line-number="16">                    <span class="kw">PointMassPrior</span>(., <span class="dv">1</span>) ), </a>
<a class="sourceLine" id="cb38-17" data-line-number="17">                opt_h0<span class="op">$</span>design) ),</a>
<a class="sourceLine" id="cb38-18" data-line-number="18">        <span class="dt">ess_sim   =</span> <span class="kw">map</span>(</a>
<a class="sourceLine" id="cb38-19" data-line-number="19">            delta, </a>
<a class="sourceLine" id="cb38-20" data-line-number="20">            <span class="op">~</span><span class="kw">sim_n</span>(opt_h0<span class="op">$</span>design, . ,datadist)<span class="op">$</span>n ) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb38-21" data-line-number="21"><span class="st">    </span><span class="kw">unnest</span>(., <span class="dt">cols =</span> <span class="kw">c</span>(power, power_sim, ess, ess_sim))</a>
<a class="sourceLine" id="cb38-22" data-line-number="22"></a>
<a class="sourceLine" id="cb38-23" data-line-number="23"><span class="kw">print</span>(tbl_performance)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   delta  power power_sim   ess ess_sim
##   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1   0   0.0250    0.0250  57.2    57.3
## 2   0.4 0.802     0.802  118.    118.</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">testthat<span class="op">::</span><span class="kw">expect_lte</span>(</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">    tbl_performance <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(delta <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(power_sim),</a>
<a class="sourceLine" id="cb40-3" data-line-number="3">    alpha <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>tol) )</a>
<a class="sourceLine" id="cb40-4" data-line-number="4"></a>
<a class="sourceLine" id="cb40-5" data-line-number="5">testthat<span class="op">::</span><span class="kw">expect_gte</span>(</a>
<a class="sourceLine" id="cb40-6" data-line-number="6">    tbl_performance <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(delta <span class="op">==</span><span class="st"> </span><span class="fl">0.4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(power_sim),</a>
<a class="sourceLine" id="cb40-7" data-line-number="7">    min_power <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>tol) )</a>
<a class="sourceLine" id="cb40-8" data-line-number="8"></a>
<a class="sourceLine" id="cb40-9" data-line-number="9"><span class="co"># make sure that evaluate() leads to same results</span></a>
<a class="sourceLine" id="cb40-10" data-line-number="10">testthat<span class="op">::</span><span class="kw">expect_equal</span>(</a>
<a class="sourceLine" id="cb40-11" data-line-number="11">    tbl_performance<span class="op">$</span>power, tbl_performance<span class="op">$</span>power_sim, </a>
<a class="sourceLine" id="cb40-12" data-line-number="12">    <span class="dt">tol   =</span> tol,</a>
<a class="sourceLine" id="cb40-13" data-line-number="13">    <span class="dt">scale =</span> <span class="dv">1</span> )</a>
<a class="sourceLine" id="cb40-14" data-line-number="14"></a>
<a class="sourceLine" id="cb40-15" data-line-number="15">testthat<span class="op">::</span><span class="kw">expect_equal</span>(</a>
<a class="sourceLine" id="cb40-16" data-line-number="16">    tbl_performance<span class="op">$</span>ess, tbl_performance<span class="op">$</span>ess_sim, </a>
<a class="sourceLine" id="cb40-17" data-line-number="17">    <span class="dt">tol   =</span> tol_n,</a>
<a class="sourceLine" id="cb40-18" data-line-number="18">    <span class="dt">scale =</span> <span class="dv">1</span> )</a></code></pre></div>
<p>The expected sample size under the null must be lower or equal than
the expected sample size of the inital <code>rpact</code> group-sequential design.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">testthat<span class="op">::</span><span class="kw">expect_gte</span>(</a>
<a class="sourceLine" id="cb41-2" data-line-number="2">    <span class="kw">evaluate</span>(ess0, </a>
<a class="sourceLine" id="cb41-3" data-line-number="3">             tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb41-4" data-line-number="4"><span class="st">                </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;two-stage&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb41-5" data-line-number="5"><span class="st">                </span><span class="kw">pull</span>(initial) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb41-6" data-line-number="6"><span class="st">                </span>.[[<span class="dv">1</span>]] ),</a>
<a class="sourceLine" id="cb41-7" data-line-number="7">    <span class="kw">evaluate</span>(ess0, opt_h0<span class="op">$</span>design) )</a></code></pre></div>
</div>
</div>
<div id="variantI_3" class="section level2">
<h2><span class="header-section-number">2.4</span> Variant I-3: Conditional Power Constraint</h2>
<div id="objective-2" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Objective</h3>
<p>Same as in <a href="scenarioI.html#variantI_1">I-1</a>, i.e., expected sample size under the
alternative point prior is minimized.</p>
</div>
<div id="constraints-2" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Constraints</h3>
<p>Besides the previous global type one error rate and power constraints,
an additional constraint on <em>conditional</em> power is imposed.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">cp       &lt;-<span class="st"> </span><span class="kw">ConditionalPower</span>(datadist, prior)</a>
<a class="sourceLine" id="cb42-2" data-line-number="2">cp_cnstr &lt;-<span class="st"> </span>cp <span class="op">&gt;=</span><span class="st"> </span><span class="fl">.7</span></a></code></pre></div>
</div>
<div id="initial-design-1" class="section level3">
<h3><span class="header-section-number">2.4.3</span> Initial Design</h3>
<p>The same initial (generic two-stage) design as in <a href="scenarioI.html#variantI_1">I-1</a> is used.</p>
</div>
<div id="optimization-2" class="section level3">
<h3><span class="header-section-number">2.4.4</span> Optimization</h3>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">opt_cp &lt;-<span class="st"> </span><span class="kw">minimize</span>(</a>
<a class="sourceLine" id="cb43-2" data-line-number="2">      </a>
<a class="sourceLine" id="cb43-3" data-line-number="3">    ess,</a>
<a class="sourceLine" id="cb43-4" data-line-number="4">    <span class="kw">subject_to</span>(</a>
<a class="sourceLine" id="cb43-5" data-line-number="5">        toer_cnstr,</a>
<a class="sourceLine" id="cb43-6" data-line-number="6">        pow_cnstr,</a>
<a class="sourceLine" id="cb43-7" data-line-number="7">        cp_cnstr <span class="co"># new constraint</span></a>
<a class="sourceLine" id="cb43-8" data-line-number="8">    ),</a>
<a class="sourceLine" id="cb43-9" data-line-number="9"></a>
<a class="sourceLine" id="cb43-10" data-line-number="10">    <span class="dt">initial_design =</span> tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb43-11" data-line-number="11"><span class="st">        </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;two-stage&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb43-12" data-line-number="12"><span class="st">        </span><span class="kw">pull</span>(initial) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb43-13" data-line-number="13"><span class="st">        </span>.[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb43-14" data-line-number="14">    <span class="dt">opts =</span> opts )</a></code></pre></div>
</div>
<div id="test-cases-2" class="section level3">
<h3><span class="header-section-number">2.4.5</span> Test Cases</h3>
<p>Check if the optimization algorithm converged.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">opt_cp<span class="op">$</span>nloptr_return<span class="op">$</span>iterations <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="st">    </span>{<span class="kw">print</span>(.); .} <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb44-3" data-line-number="3"><span class="st">    </span>{testthat<span class="op">::</span><span class="kw">expect_true</span>(. <span class="op">&lt;</span><span class="st"> </span>opts<span class="op">$</span>maxeval)}</a></code></pre></div>
<pre><code>## [1] 4591</code></pre>
<p>Check constraints.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">tbl_performance &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb46-2" data-line-number="2">    <span class="dt">delta =</span> <span class="kw">c</span>(.<span class="dv">0</span>, <span class="fl">.4</span>) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-3" data-line-number="3"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb46-4" data-line-number="4">        <span class="dt">power     =</span> <span class="kw">map</span>(</a>
<a class="sourceLine" id="cb46-5" data-line-number="5">            delta, </a>
<a class="sourceLine" id="cb46-6" data-line-number="6">            <span class="op">~</span><span class="kw">evaluate</span>(</a>
<a class="sourceLine" id="cb46-7" data-line-number="7">                <span class="kw">Power</span>(datadist, <span class="kw">PointMassPrior</span>(., <span class="dv">1</span>)), </a>
<a class="sourceLine" id="cb46-8" data-line-number="8">                opt_cp<span class="op">$</span>design) ),</a>
<a class="sourceLine" id="cb46-9" data-line-number="9">        <span class="dt">power_sim =</span> <span class="kw">map</span>(</a>
<a class="sourceLine" id="cb46-10" data-line-number="10">            delta, </a>
<a class="sourceLine" id="cb46-11" data-line-number="11">            <span class="op">~</span><span class="kw">sim_pr_reject</span>(opt_cp<span class="op">$</span>design, ., datadist)<span class="op">$</span>prob),</a>
<a class="sourceLine" id="cb46-12" data-line-number="12">        <span class="dt">ess       =</span> <span class="kw">map</span>(</a>
<a class="sourceLine" id="cb46-13" data-line-number="13">            delta, </a>
<a class="sourceLine" id="cb46-14" data-line-number="14">            <span class="op">~</span><span class="kw">evaluate</span>(<span class="kw">ExpectedSampleSize</span>(</a>
<a class="sourceLine" id="cb46-15" data-line-number="15">                    datadist, </a>
<a class="sourceLine" id="cb46-16" data-line-number="16">                    <span class="kw">PointMassPrior</span>(., <span class="dv">1</span>) ), </a>
<a class="sourceLine" id="cb46-17" data-line-number="17">                opt_cp<span class="op">$</span>design) ),</a>
<a class="sourceLine" id="cb46-18" data-line-number="18">        <span class="dt">ess_sim   =</span> <span class="kw">map</span>(</a>
<a class="sourceLine" id="cb46-19" data-line-number="19">            delta, </a>
<a class="sourceLine" id="cb46-20" data-line-number="20">            <span class="op">~</span><span class="kw">sim_n</span>(opt_cp<span class="op">$</span>design, . ,datadist)<span class="op">$</span>n ) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-21" data-line-number="21"><span class="st">    </span><span class="kw">unnest</span>(., <span class="dt">cols =</span> <span class="kw">c</span>(power, power_sim, ess, ess_sim))</a>
<a class="sourceLine" id="cb46-22" data-line-number="22"></a>
<a class="sourceLine" id="cb46-23" data-line-number="23"><span class="kw">print</span>(tbl_performance)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   delta  power power_sim   ess ess_sim
##   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1   0   0.0250    0.0250  68.9    69.0
## 2   0.4 0.799     0.799   79.8    79.8</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">testthat<span class="op">::</span><span class="kw">expect_lte</span>(</a>
<a class="sourceLine" id="cb48-2" data-line-number="2">    tbl_performance <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(delta <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(power_sim),</a>
<a class="sourceLine" id="cb48-3" data-line-number="3">    alpha <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>tol) )</a>
<a class="sourceLine" id="cb48-4" data-line-number="4"></a>
<a class="sourceLine" id="cb48-5" data-line-number="5">testthat<span class="op">::</span><span class="kw">expect_gte</span>(</a>
<a class="sourceLine" id="cb48-6" data-line-number="6">    tbl_performance <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(delta <span class="op">==</span><span class="st"> </span><span class="fl">0.4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(power_sim),</a>
<a class="sourceLine" id="cb48-7" data-line-number="7">    min_power <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>tol) )</a>
<a class="sourceLine" id="cb48-8" data-line-number="8"></a>
<a class="sourceLine" id="cb48-9" data-line-number="9"><span class="co"># make sure that evaluate() leads to same results</span></a>
<a class="sourceLine" id="cb48-10" data-line-number="10">testthat<span class="op">::</span><span class="kw">expect_equal</span>(</a>
<a class="sourceLine" id="cb48-11" data-line-number="11">    tbl_performance<span class="op">$</span>power, tbl_performance<span class="op">$</span>power_sim, </a>
<a class="sourceLine" id="cb48-12" data-line-number="12">    <span class="dt">tol   =</span> tol,</a>
<a class="sourceLine" id="cb48-13" data-line-number="13">    <span class="dt">scale =</span> <span class="dv">1</span> )</a>
<a class="sourceLine" id="cb48-14" data-line-number="14"></a>
<a class="sourceLine" id="cb48-15" data-line-number="15">testthat<span class="op">::</span><span class="kw">expect_equal</span>(</a>
<a class="sourceLine" id="cb48-16" data-line-number="16">    tbl_performance<span class="op">$</span>ess, tbl_performance<span class="op">$</span>ess_sim, </a>
<a class="sourceLine" id="cb48-17" data-line-number="17">    <span class="dt">tol   =</span> tol_n,</a>
<a class="sourceLine" id="cb48-18" data-line-number="18">    <span class="dt">scale =</span> <span class="dv">1</span> )</a></code></pre></div>
<p>The conditional power constraint is evaluated and tested on a
grid over the continuation region (both simulated an via numerical
integration).</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb49-2" data-line-number="2">    <span class="dt">x1     =</span> <span class="kw">seq</span>(opt_cp<span class="op">$</span>design<span class="op">@</span>c1f, opt_cp<span class="op">$</span>design<span class="op">@</span>c1e, <span class="dt">length.out =</span> <span class="dv">25</span>),</a>
<a class="sourceLine" id="cb49-3" data-line-number="3">    <span class="dt">cp     =</span> <span class="kw">map_dbl</span>(x1, <span class="op">~</span><span class="kw">evaluate</span>(cp, opt_cp<span class="op">$</span>design, .)),</a>
<a class="sourceLine" id="cb49-4" data-line-number="4">    <span class="dt">cp_sim =</span> <span class="kw">map_dbl</span>(x1, <span class="cf">function</span>(x1) {</a>
<a class="sourceLine" id="cb49-5" data-line-number="5">        x2  &lt;-<span class="st"> </span><span class="kw">simulate</span>(datadist, <span class="dv">10</span><span class="op">^</span><span class="dv">6</span>, <span class="kw">n2</span>(opt_cp<span class="op">$</span>design, x1), <span class="fl">.4</span>, <span class="dv">42</span>)</a>
<a class="sourceLine" id="cb49-6" data-line-number="6">        rej &lt;-<span class="st"> </span><span class="kw">ifelse</span>(x2 <span class="op">&gt;</span><span class="st"> </span><span class="kw">c2</span>(opt_cp<span class="op">$</span>design, x1), <span class="dv">1</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb49-7" data-line-number="7">        <span class="kw">return</span>(<span class="kw">mean</span>(rej))</a>
<a class="sourceLine" id="cb49-8" data-line-number="8">    }) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb49-9" data-line-number="9"><span class="st">  </span>{<span class="kw">print</span>(.); .} <span class="op">%&gt;%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb49-10" data-line-number="10">      testthat<span class="op">::</span><span class="kw">expect_true</span>(<span class="kw">all</span>(.<span class="op">$</span>cp     <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.7</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>tol)))</a>
<a class="sourceLine" id="cb49-11" data-line-number="11">      testthat<span class="op">::</span><span class="kw">expect_true</span>(<span class="kw">all</span>(.<span class="op">$</span>cp_sim <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.7</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>tol))) </a>
<a class="sourceLine" id="cb49-12" data-line-number="12">      testthat<span class="op">::</span><span class="kw">expect_true</span>(<span class="kw">all</span>(<span class="kw">abs</span>(.<span class="op">$</span>cp <span class="op">-</span><span class="st"> </span>.<span class="op">$</span>cp_sim) <span class="op">&lt;=</span><span class="st"> </span>tol)) }</a></code></pre></div>
<pre><code>## # A tibble: 25 x 3
##       x1    cp cp_sim
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1 0.810 0.701  0.701
##  2 0.872 0.698  0.699
##  3 0.934 0.701  0.701
##  4 0.995 0.698  0.698
##  5 1.06  0.700  0.700
##  6 1.12  0.702  0.703
##  7 1.18  0.699  0.699
##  8 1.24  0.703  0.703
##  9 1.30  0.713  0.713
## 10 1.37  0.718  0.718
## # … with 15 more rows</code></pre>
<p>Finally, the expected sample size under the alternative prior should
be larger than in the case without the constraint <a href="scenarioI.html#variantI_1">I-1</a>.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1">testthat<span class="op">::</span><span class="kw">expect_gte</span>(</a>
<a class="sourceLine" id="cb51-2" data-line-number="2">    <span class="kw">evaluate</span>(ess, opt_cp<span class="op">$</span>design),</a>
<a class="sourceLine" id="cb51-3" data-line-number="3">    <span class="kw">evaluate</span>(</a>
<a class="sourceLine" id="cb51-4" data-line-number="4">        ess, </a>
<a class="sourceLine" id="cb51-5" data-line-number="5">        tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb51-6" data-line-number="6"><span class="st">            </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;two-stage&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb51-7" data-line-number="7"><span class="st">            </span><span class="kw">pull</span>(optimal) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb51-8" data-line-number="8"><span class="st">            </span>.[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb51-9" data-line-number="9"><span class="st">            </span>.<span class="op">$</span>design ) )</a></code></pre></div>
</div>
</div>
<div id="plot-two-stage-designs" class="section level2">
<h2><span class="header-section-number">2.5</span> Plot Two-Stage Designs</h2>
<p>The following figure shows the three optimal two-stage designs side by
side.
The effect of the conditional power constraint (CP not below 0.7) is
clearly visible and the very different characteristics between
optimizing under the null or the alternative are clearly visible.</p>
<p><img src="adoptr-validation-report_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="scenarioII.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/kkmann/adoptr-validation-report/edit/master/01-scenario-I.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["adoptr-validation-report.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
