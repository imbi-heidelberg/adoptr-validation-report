<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Scenario II: large effect, Gaussian prior | Validation Report for adoptr package</title>
  <meta name="description" content="This is an automatically generated validation report for the adoptr R package published via bookdown." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Scenario II: large effect, Gaussian prior | Validation Report for adoptr package" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is an automatically generated validation report for the adoptr R package published via bookdown." />
  <meta name="github-repo" content="kkmann/adoptr-validation-report" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Scenario II: large effect, Gaussian prior | Validation Report for adoptr package" />
  
  <meta name="twitter:description" content="This is an automatically generated validation report for the adoptr R package published via bookdown." />
  

<meta name="author" content="Kevin Kunzmann &amp; Maximilian Pilz" />


<meta name="date" content="2019-12-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="scenarioI.html"/>
<link rel="next" href="scenarioIII.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Validation Report for adoptr Package</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#preliminaries"><i class="fa fa-check"></i><b>1.1</b> Preliminaries</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#scope"><i class="fa fa-check"></i><b>1.2</b> Scope</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#validating-a-local-installation-of-adoptr"><i class="fa fa-check"></i><b>1.2.1</b> Validating a local installation of adoptr</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#validation-scenarios"><i class="fa fa-check"></i><b>1.3</b> Validation Scenarios</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#scenario-i-large-effect-point-prior"><i class="fa fa-check"></i><b>1.3.1</b> <a href="scenarioI.html#scenarioI">Scenario I: Large effect, point prior</a></a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#scenario-ii-large-effect-gaussian-prior"><i class="fa fa-check"></i><b>1.3.2</b> <a href="scenarioII.html#scenarioII">Scenario II: Large effect, Gaussian prior</a></a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#scenario-iii-large-effect-uniform-prior"><i class="fa fa-check"></i><b>1.3.3</b> <a href="scenarioIII.html#scenarioIII">Scenario III: Large effect, uniform prior</a></a></li>
<li class="chapter" data-level="1.3.4" data-path="index.html"><a href="index.html#scenario-iv-smaller-effect-size-larger-trials"><i class="fa fa-check"></i><b>1.3.4</b> <a href="scenarioIV.html#scenarioIV">Scenario IV: Smaller effect size, larger trials</a></a></li>
<li class="chapter" data-level="1.3.5" data-path="index.html"><a href="index.html#scenario-v-single-arm-design-medium-effect-size"><i class="fa fa-check"></i><b>1.3.5</b> <a href="scenarioV.html#scenarioV">Scenario V: Single-arm design, medium effect size</a></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#technical-setup"><i class="fa fa-check"></i><b>1.4</b> Technical Setup</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="scenarioI.html"><a href="scenarioI.html"><i class="fa fa-check"></i><b>2</b> Scenario I: large effect, point prior</a><ul>
<li class="chapter" data-level="2.1" data-path="scenarioI.html"><a href="scenarioI.html#details"><i class="fa fa-check"></i><b>2.1</b> Details</a></li>
<li class="chapter" data-level="2.2" data-path="scenarioI.html"><a href="scenarioI.html#variantI_1"><i class="fa fa-check"></i><b>2.2</b> Variant I-1: Minimizing Expected Sample Size under Point Prior</a><ul>
<li class="chapter" data-level="2.2.1" data-path="scenarioI.html"><a href="scenarioI.html#objective"><i class="fa fa-check"></i><b>2.2.1</b> Objective</a></li>
<li class="chapter" data-level="2.2.2" data-path="scenarioI.html"><a href="scenarioI.html#constraints"><i class="fa fa-check"></i><b>2.2.2</b> Constraints</a></li>
<li class="chapter" data-level="2.2.3" data-path="scenarioI.html"><a href="scenarioI.html#initial-designs"><i class="fa fa-check"></i><b>2.2.3</b> Initial Designs</a></li>
<li class="chapter" data-level="2.2.4" data-path="scenarioI.html"><a href="scenarioI.html#optimization"><i class="fa fa-check"></i><b>2.2.4</b> Optimization</a></li>
<li class="chapter" data-level="2.2.5" data-path="scenarioI.html"><a href="scenarioI.html#test-cases"><i class="fa fa-check"></i><b>2.2.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="scenarioI.html"><a href="scenarioI.html#variantI_2"><i class="fa fa-check"></i><b>2.3</b> Variant I-2: Minimizing Expected Sample Size under Null Hypothesis</a><ul>
<li class="chapter" data-level="2.3.1" data-path="scenarioI.html"><a href="scenarioI.html#objective-1"><i class="fa fa-check"></i><b>2.3.1</b> Objective</a></li>
<li class="chapter" data-level="2.3.2" data-path="scenarioI.html"><a href="scenarioI.html#constraints-1"><i class="fa fa-check"></i><b>2.3.2</b> Constraints</a></li>
<li class="chapter" data-level="2.3.3" data-path="scenarioI.html"><a href="scenarioI.html#initial-design"><i class="fa fa-check"></i><b>2.3.3</b> Initial Design</a></li>
<li class="chapter" data-level="2.3.4" data-path="scenarioI.html"><a href="scenarioI.html#optimization-1"><i class="fa fa-check"></i><b>2.3.4</b> Optimization</a></li>
<li class="chapter" data-level="2.3.5" data-path="scenarioI.html"><a href="scenarioI.html#test-cases-1"><i class="fa fa-check"></i><b>2.3.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="scenarioI.html"><a href="scenarioI.html#variantI_3"><i class="fa fa-check"></i><b>2.4</b> Variant I-3: Conditional Power Constraint</a><ul>
<li class="chapter" data-level="2.4.1" data-path="scenarioI.html"><a href="scenarioI.html#objective-2"><i class="fa fa-check"></i><b>2.4.1</b> Objective</a></li>
<li class="chapter" data-level="2.4.2" data-path="scenarioI.html"><a href="scenarioI.html#constraints-2"><i class="fa fa-check"></i><b>2.4.2</b> Constraints</a></li>
<li class="chapter" data-level="2.4.3" data-path="scenarioI.html"><a href="scenarioI.html#initial-design-1"><i class="fa fa-check"></i><b>2.4.3</b> Initial Design</a></li>
<li class="chapter" data-level="2.4.4" data-path="scenarioI.html"><a href="scenarioI.html#optimization-2"><i class="fa fa-check"></i><b>2.4.4</b> Optimization</a></li>
<li class="chapter" data-level="2.4.5" data-path="scenarioI.html"><a href="scenarioI.html#test-cases-2"><i class="fa fa-check"></i><b>2.4.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="scenarioI.html"><a href="scenarioI.html#plot-two-stage-designs"><i class="fa fa-check"></i><b>2.5</b> Plot Two-Stage Designs</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="scenarioII.html"><a href="scenarioII.html"><i class="fa fa-check"></i><b>3</b> Scenario II: large effect, Gaussian prior</a><ul>
<li class="chapter" data-level="3.1" data-path="scenarioII.html"><a href="scenarioII.html#details-1"><i class="fa fa-check"></i><b>3.1</b> Details</a></li>
<li class="chapter" data-level="3.2" data-path="scenarioII.html"><a href="scenarioII.html#variantII_1"><i class="fa fa-check"></i><b>3.2</b> Variant II-1: Minimizing Expected Sample Size under Point Prior</a><ul>
<li class="chapter" data-level="3.2.1" data-path="scenarioII.html"><a href="scenarioII.html#objective-3"><i class="fa fa-check"></i><b>3.2.1</b> Objective</a></li>
<li class="chapter" data-level="3.2.2" data-path="scenarioII.html"><a href="scenarioII.html#constraints-3"><i class="fa fa-check"></i><b>3.2.2</b> Constraints</a></li>
<li class="chapter" data-level="3.2.3" data-path="scenarioII.html"><a href="scenarioII.html#initial-design-2"><i class="fa fa-check"></i><b>3.2.3</b> Initial Design</a></li>
<li class="chapter" data-level="3.2.4" data-path="scenarioII.html"><a href="scenarioII.html#optimization-3"><i class="fa fa-check"></i><b>3.2.4</b> Optimization</a></li>
<li class="chapter" data-level="3.2.5" data-path="scenarioII.html"><a href="scenarioII.html#test-cases-3"><i class="fa fa-check"></i><b>3.2.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="scenarioII.html"><a href="scenarioII.html#variantII_2"><i class="fa fa-check"></i><b>3.3</b> Variant II-2: Minimizing Expected Sample Size under Null Hypothesis</a><ul>
<li class="chapter" data-level="3.3.1" data-path="scenarioII.html"><a href="scenarioII.html#objective-4"><i class="fa fa-check"></i><b>3.3.1</b> Objective</a></li>
<li class="chapter" data-level="3.3.2" data-path="scenarioII.html"><a href="scenarioII.html#constraints-4"><i class="fa fa-check"></i><b>3.3.2</b> Constraints</a></li>
<li class="chapter" data-level="3.3.3" data-path="scenarioII.html"><a href="scenarioII.html#initial-design-3"><i class="fa fa-check"></i><b>3.3.3</b> Initial Design</a></li>
<li class="chapter" data-level="3.3.4" data-path="scenarioII.html"><a href="scenarioII.html#optimization-4"><i class="fa fa-check"></i><b>3.3.4</b> Optimization</a></li>
<li class="chapter" data-level="3.3.5" data-path="scenarioII.html"><a href="scenarioII.html#test-cases-4"><i class="fa fa-check"></i><b>3.3.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="scenarioII.html"><a href="scenarioII.html#variantII_3"><i class="fa fa-check"></i><b>3.4</b> Variant II-3: Conditional Power Constraint</a><ul>
<li class="chapter" data-level="3.4.1" data-path="scenarioII.html"><a href="scenarioII.html#objective-5"><i class="fa fa-check"></i><b>3.4.1</b> Objective</a></li>
<li class="chapter" data-level="3.4.2" data-path="scenarioII.html"><a href="scenarioII.html#constraints-5"><i class="fa fa-check"></i><b>3.4.2</b> Constraints</a></li>
<li class="chapter" data-level="3.4.3" data-path="scenarioII.html"><a href="scenarioII.html#initial-design-4"><i class="fa fa-check"></i><b>3.4.3</b> Initial Design</a></li>
<li class="chapter" data-level="3.4.4" data-path="scenarioII.html"><a href="scenarioII.html#optimization-5"><i class="fa fa-check"></i><b>3.4.4</b> Optimization</a></li>
<li class="chapter" data-level="3.4.5" data-path="scenarioII.html"><a href="scenarioII.html#test-cases-5"><i class="fa fa-check"></i><b>3.4.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="scenarioII.html"><a href="scenarioII.html#plot-two-stage-designs-1"><i class="fa fa-check"></i><b>3.5</b> Plot Two-Stage Designs</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="scenarioIII.html"><a href="scenarioIII.html"><i class="fa fa-check"></i><b>4</b> Scenario III: large effect, uniform prior</a><ul>
<li class="chapter" data-level="4.1" data-path="scenarioIII.html"><a href="scenarioIII.html#details-2"><i class="fa fa-check"></i><b>4.1</b> Details</a></li>
<li class="chapter" data-level="4.2" data-path="scenarioIII.html"><a href="scenarioIII.html#variantIII_1"><i class="fa fa-check"></i><b>4.2</b> Variant III.1: Convergence under prior concentration</a><ul>
<li class="chapter" data-level="4.2.1" data-path="scenarioIII.html"><a href="scenarioIII.html#objective-6"><i class="fa fa-check"></i><b>4.2.1</b> Objective</a></li>
<li class="chapter" data-level="4.2.2" data-path="scenarioIII.html"><a href="scenarioIII.html#constraints-6"><i class="fa fa-check"></i><b>4.2.2</b> Constraints</a></li>
<li class="chapter" data-level="4.2.3" data-path="scenarioIII.html"><a href="scenarioIII.html#optimization-problem"><i class="fa fa-check"></i><b>4.2.3</b> Optimization problem</a></li>
<li class="chapter" data-level="4.2.4" data-path="scenarioIII.html"><a href="scenarioIII.html#test-cases-6"><i class="fa fa-check"></i><b>4.2.4</b> Test cases</a></li>
<li class="chapter" data-level="4.2.5" data-path="scenarioIII.html"><a href="scenarioIII.html#plot-designs"><i class="fa fa-check"></i><b>4.2.5</b> Plot designs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="scenarioIV.html"><a href="scenarioIV.html"><i class="fa fa-check"></i><b>5</b> Scenario IV: smaller effect, point prior</a><ul>
<li class="chapter" data-level="5.1" data-path="scenarioIV.html"><a href="scenarioIV.html#details-3"><i class="fa fa-check"></i><b>5.1</b> Details</a></li>
<li class="chapter" data-level="5.2" data-path="scenarioIV.html"><a href="scenarioIV.html#variantIV_1"><i class="fa fa-check"></i><b>5.2</b> Variant IV-1: Minimizing Expected Sample Size under Point Prior</a><ul>
<li class="chapter" data-level="5.2.1" data-path="scenarioIV.html"><a href="scenarioIV.html#objective-7"><i class="fa fa-check"></i><b>5.2.1</b> Objective</a></li>
<li class="chapter" data-level="5.2.2" data-path="scenarioIV.html"><a href="scenarioIV.html#constraints-7"><i class="fa fa-check"></i><b>5.2.2</b> Constraints</a></li>
<li class="chapter" data-level="5.2.3" data-path="scenarioIV.html"><a href="scenarioIV.html#initial-design-5"><i class="fa fa-check"></i><b>5.2.3</b> Initial Design</a></li>
<li class="chapter" data-level="5.2.4" data-path="scenarioIV.html"><a href="scenarioIV.html#optimization-6"><i class="fa fa-check"></i><b>5.2.4</b> Optimization</a></li>
<li class="chapter" data-level="5.2.5" data-path="scenarioIV.html"><a href="scenarioIV.html#test-cases-7"><i class="fa fa-check"></i><b>5.2.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="scenarioIV.html"><a href="scenarioIV.html#variantIV_2"><i class="fa fa-check"></i><b>5.3</b> Variant IV-2: Increase Power</a><ul>
<li class="chapter" data-level="5.3.1" data-path="scenarioIV.html"><a href="scenarioIV.html#objective-8"><i class="fa fa-check"></i><b>5.3.1</b> Objective</a></li>
<li class="chapter" data-level="5.3.2" data-path="scenarioIV.html"><a href="scenarioIV.html#constraints-8"><i class="fa fa-check"></i><b>5.3.2</b> Constraints</a></li>
<li class="chapter" data-level="5.3.3" data-path="scenarioIV.html"><a href="scenarioIV.html#initial-design-6"><i class="fa fa-check"></i><b>5.3.3</b> Initial Design</a></li>
<li class="chapter" data-level="5.3.4" data-path="scenarioIV.html"><a href="scenarioIV.html#optimization-7"><i class="fa fa-check"></i><b>5.3.4</b> Optimization</a></li>
<li class="chapter" data-level="5.3.5" data-path="scenarioIV.html"><a href="scenarioIV.html#test-cases-8"><i class="fa fa-check"></i><b>5.3.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="scenarioIV.html"><a href="scenarioIV.html#variantIV_3"><i class="fa fa-check"></i><b>5.4</b> Variant IV-3: Increase Type One Error rate</a><ul>
<li class="chapter" data-level="5.4.1" data-path="scenarioIV.html"><a href="scenarioIV.html#objective-9"><i class="fa fa-check"></i><b>5.4.1</b> Objective</a></li>
<li class="chapter" data-level="5.4.2" data-path="scenarioIV.html"><a href="scenarioIV.html#constraints-9"><i class="fa fa-check"></i><b>5.4.2</b> Constraints</a></li>
<li class="chapter" data-level="5.4.3" data-path="scenarioIV.html"><a href="scenarioIV.html#initial-design-7"><i class="fa fa-check"></i><b>5.4.3</b> Initial Design</a></li>
<li class="chapter" data-level="5.4.4" data-path="scenarioIV.html"><a href="scenarioIV.html#optimization-8"><i class="fa fa-check"></i><b>5.4.4</b> Optimization</a></li>
<li class="chapter" data-level="5.4.5" data-path="scenarioIV.html"><a href="scenarioIV.html#test-cases-9"><i class="fa fa-check"></i><b>5.4.5</b> Test Cases</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="scenarioIV.html"><a href="scenarioIV.html#plot-two-stage-designs-2"><i class="fa fa-check"></i><b>5.5</b> Plot Two-Stage Designs</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="scenarioV.html"><a href="scenarioV.html"><i class="fa fa-check"></i><b>6</b> Scenario V: single-arm design, medium effect size</a><ul>
<li class="chapter" data-level="6.1" data-path="scenarioV.html"><a href="scenarioV.html#details-4"><i class="fa fa-check"></i><b>6.1</b> Details</a></li>
<li class="chapter" data-level="6.2" data-path="scenarioV.html"><a href="scenarioV.html#variantV_1"><i class="fa fa-check"></i><b>6.2</b> Variant V-1, sensitivity to integration order</a><ul>
<li class="chapter" data-level="6.2.1" data-path="scenarioV.html"><a href="scenarioV.html#objective-10"><i class="fa fa-check"></i><b>6.2.1</b> Objective</a></li>
<li class="chapter" data-level="6.2.2" data-path="scenarioV.html"><a href="scenarioV.html#constraints-10"><i class="fa fa-check"></i><b>6.2.2</b> Constraints</a></li>
<li class="chapter" data-level="6.2.3" data-path="scenarioV.html"><a href="scenarioV.html#initial-design-8"><i class="fa fa-check"></i><b>6.2.3</b> Initial Design</a></li>
<li class="chapter" data-level="6.2.4" data-path="scenarioV.html"><a href="scenarioV.html#optimization-9"><i class="fa fa-check"></i><b>6.2.4</b> Optimization</a></li>
<li class="chapter" data-level="6.2.5" data-path="scenarioV.html"><a href="scenarioV.html#test-cases-10"><i class="fa fa-check"></i><b>6.2.5</b> Test cases</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="scenarioV.html"><a href="scenarioV.html#variantV_2"><i class="fa fa-check"></i><b>6.3</b> Variant V-2, utility maximization</a><ul>
<li class="chapter" data-level="6.3.1" data-path="scenarioV.html"><a href="scenarioV.html#objective-11"><i class="fa fa-check"></i><b>6.3.1</b> Objective</a></li>
<li class="chapter" data-level="6.3.2" data-path="scenarioV.html"><a href="scenarioV.html#constraints-11"><i class="fa fa-check"></i><b>6.3.2</b> Constraints</a></li>
<li class="chapter" data-level="6.3.3" data-path="scenarioV.html"><a href="scenarioV.html#initial-design-9"><i class="fa fa-check"></i><b>6.3.3</b> Initial Design</a></li>
<li class="chapter" data-level="6.3.4" data-path="scenarioV.html"><a href="scenarioV.html#optimization-10"><i class="fa fa-check"></i><b>6.3.4</b> Optimization</a></li>
<li class="chapter" data-level="6.3.5" data-path="scenarioV.html"><a href="scenarioV.html#test-cases-11"><i class="fa fa-check"></i><b>6.3.5</b> Test cases</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="scenarioV.html"><a href="scenarioV.html#variantV_3"><i class="fa fa-check"></i><b>6.4</b> Variant V-3, n1-penalty</a><ul>
<li class="chapter" data-level="6.4.1" data-path="scenarioV.html"><a href="scenarioV.html#objective-12"><i class="fa fa-check"></i><b>6.4.1</b> Objective</a></li>
<li class="chapter" data-level="6.4.2" data-path="scenarioV.html"><a href="scenarioV.html#constraints-12"><i class="fa fa-check"></i><b>6.4.2</b> Constraints</a></li>
<li class="chapter" data-level="6.4.3" data-path="scenarioV.html"><a href="scenarioV.html#initial-design-10"><i class="fa fa-check"></i><b>6.4.3</b> Initial Design</a></li>
<li class="chapter" data-level="6.4.4" data-path="scenarioV.html"><a href="scenarioV.html#optimization-11"><i class="fa fa-check"></i><b>6.4.4</b> Optimization</a></li>
<li class="chapter" data-level="6.4.5" data-path="scenarioV.html"><a href="scenarioV.html#test-cases-12"><i class="fa fa-check"></i><b>6.4.5</b> Test cases</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="scenarioV.html"><a href="scenarioV.html#variantV_4"><i class="fa fa-check"></i><b>6.5</b> Variant V-4, n2-penalty</a><ul>
<li class="chapter" data-level="6.5.1" data-path="scenarioV.html"><a href="scenarioV.html#objective-13"><i class="fa fa-check"></i><b>6.5.1</b> Objective</a></li>
<li class="chapter" data-level="6.5.2" data-path="scenarioV.html"><a href="scenarioV.html#constraints-13"><i class="fa fa-check"></i><b>6.5.2</b> Constraints</a></li>
<li class="chapter" data-level="6.5.3" data-path="scenarioV.html"><a href="scenarioV.html#initial-design-11"><i class="fa fa-check"></i><b>6.5.3</b> Initial Design</a></li>
<li class="chapter" data-level="6.5.4" data-path="scenarioV.html"><a href="scenarioV.html#optimization-12"><i class="fa fa-check"></i><b>6.5.4</b> Optimization</a></li>
<li class="chapter" data-level="6.5.5" data-path="scenarioV.html"><a href="scenarioV.html#test-cases-13"><i class="fa fa-check"></i><b>6.5.5</b> Test cases</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Validation Report for <strong>adoptr</strong> package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="scenarioII" class="section level1">
<h1><span class="header-section-number">3</span> Scenario II: large effect, Gaussian prior</h1>
<div id="details-1" class="section level2">
<h2><span class="header-section-number">3.1</span> Details</h2>
<p>In this scenario, we revisit the case from <a href="scenarioI.html#scenarioI">Scenario I</a>, but
are not assuming a point prior any more.
Instead, a Gaussian prior with mean <span class="math inline">\(\vartheta = 0.4\)</span> and
variance <span class="math inline">\(\tau^2 = 0.2^2\)</span> on the effect size is assumed, i.e.
<span class="math inline">\(\delta \sim \mathcal{N} (0.4, 0.2^2)\)</span>.</p>
<p>In order to fulfill regulatory considerations, the type one error rate
is still protected under the point prior <span class="math inline">\(\delta = 0\)</span> at the level
of significance <span class="math inline">\(\alpha = 0.025\)</span>.</p>
<p>The power constraint, however, needs to be modified.
It is not senseful to compute the power as rejection probability under
the full prior, because effect sizes less than a minimal clinically relevant
effect do not show (sufficient) evidence againt the null hypothesis.
Therefore, we assume a minimal clinically relevant effect size
<span class="math inline">\(\delta = 0.0\)</span> and condition the prior on values <span class="math inline">\(\delta &gt; 0\)</span>
to compute expected power.
In the following, the expected power should be at least <span class="math inline">\(0.8\)</span>.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="co"># data distribution and priors</span></a>
<a class="sourceLine" id="cb52-2" data-line-number="2">datadist   &lt;-<span class="st"> </span><span class="kw">Normal</span>(<span class="dt">two_armed =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb52-3" data-line-number="3">H_<span class="dv">0</span>        &lt;-<span class="st"> </span><span class="kw">PointMassPrior</span>(.<span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb52-4" data-line-number="4">prior      &lt;-<span class="st"> </span><span class="kw">ContinuousPrior</span>(<span class="cf">function</span>(delta) <span class="kw">dnorm</span>(delta, <span class="dt">mean =</span> <span class="fl">.4</span>, <span class="dt">sd =</span> <span class="fl">.2</span>),</a>
<a class="sourceLine" id="cb52-5" data-line-number="5">                              <span class="dt">support =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb52-6" data-line-number="6">                              <span class="dt">tighten_support =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb52-7" data-line-number="7"></a>
<a class="sourceLine" id="cb52-8" data-line-number="8"><span class="co"># define constraints on type one error rate and expected power</span></a>
<a class="sourceLine" id="cb52-9" data-line-number="9">alpha      &lt;-<span class="st"> </span><span class="fl">0.025</span></a>
<a class="sourceLine" id="cb52-10" data-line-number="10">min_epower &lt;-<span class="st"> </span><span class="fl">0.8</span></a>
<a class="sourceLine" id="cb52-11" data-line-number="11">toer_cnstr &lt;-<span class="st"> </span><span class="kw">Power</span>(datadist, H_<span class="dv">0</span>) <span class="op">&lt;=</span><span class="st"> </span>alpha</a>
<a class="sourceLine" id="cb52-12" data-line-number="12">epow_cnstr &lt;-<span class="st"> </span><span class="kw">Power</span>(datadist, <span class="kw">condition</span>(prior, <span class="kw">c</span>(<span class="fl">0.0</span>, prior<span class="op">@</span>support[<span class="dv">2</span>]))) <span class="op">&gt;=</span><span class="st"> </span>min_epower</a></code></pre></div>
</div>
<div id="variantII_1" class="section level2">
<h2><span class="header-section-number">3.2</span> Variant II-1: Minimizing Expected Sample Size under Point Prior</h2>
<div id="objective-3" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Objective</h3>
<p>Expected sample size under the full prior is minimized, i.e.,
<span class="math inline">\(\boldsymbol{E}\big[n(\mathcal{D})\big]\)</span>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">ess &lt;-<span class="st"> </span><span class="kw">ExpectedSampleSize</span>(datadist, prior)</a></code></pre></div>
</div>
<div id="constraints-3" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Constraints</h3>
<p>No additional constraints are considered in this variant.</p>
</div>
<div id="initial-design-2" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Initial Design</h3>
<p>For this example, the optimal one-stage, group-sequential, and generic
two-stage designs are computed.
While the initial design for the one-stage case is determined heuristically,
both the group sequential and the generic two-stage designs are
optimized starting from the a group-sequential design that is computed by
the <code>rpact</code> package to fulfill the type one error rate constraint and
that fulfills the power constraint at an effect size of <span class="math inline">\(\delta = 0.3\)</span>.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1">order &lt;-<span class="st"> </span>5L</a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="co"># data frame of initial designs </span></a>
<a class="sourceLine" id="cb54-3" data-line-number="3">tbl_designs &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb54-4" data-line-number="4">    <span class="dt">type    =</span> <span class="kw">c</span>(<span class="st">&quot;one-stage&quot;</span>, <span class="st">&quot;group-sequential&quot;</span>, <span class="st">&quot;two-stage&quot;</span>),</a>
<a class="sourceLine" id="cb54-5" data-line-number="5">    <span class="dt">initial =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb54-6" data-line-number="6">        <span class="kw">OneStageDesign</span>(<span class="dv">250</span>, <span class="fl">2.0</span>),</a>
<a class="sourceLine" id="cb54-7" data-line-number="7">        <span class="kw">rpact_design</span>(<span class="fl">0.3</span>, <span class="fl">0.025</span>, <span class="fl">0.8</span>, <span class="ot">TRUE</span>, order),</a>
<a class="sourceLine" id="cb54-8" data-line-number="8">        <span class="kw">TwoStageDesign</span>(<span class="kw">rpact_design</span>(<span class="fl">0.3</span>, <span class="fl">0.025</span>, <span class="fl">0.8</span>, <span class="ot">TRUE</span>, order))) )</a></code></pre></div>
<p>The order of integration is set to 5.</p>
</div>
<div id="optimization-3" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Optimization</h3>
<p>For all these three initial designs, the resulting optimal designs are
computed.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1">tbl_designs &lt;-<span class="st"> </span>tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb55-3" data-line-number="3">       <span class="dt">optimal =</span> purrr<span class="op">::</span><span class="kw">map</span>(initial, <span class="op">~</span><span class="kw">minimize</span>(</a>
<a class="sourceLine" id="cb55-4" data-line-number="4">         </a>
<a class="sourceLine" id="cb55-5" data-line-number="5">          ess,</a>
<a class="sourceLine" id="cb55-6" data-line-number="6">          <span class="kw">subject_to</span>(</a>
<a class="sourceLine" id="cb55-7" data-line-number="7">              toer_cnstr,</a>
<a class="sourceLine" id="cb55-8" data-line-number="8">              epow_cnstr</a>
<a class="sourceLine" id="cb55-9" data-line-number="9">          ),</a>
<a class="sourceLine" id="cb55-10" data-line-number="10">          </a>
<a class="sourceLine" id="cb55-11" data-line-number="11">          <span class="dt">initial_design =</span> ., </a>
<a class="sourceLine" id="cb55-12" data-line-number="12">          <span class="dt">opts           =</span> opts)) )</a></code></pre></div>
</div>
<div id="test-cases-3" class="section level3">
<h3><span class="header-section-number">3.2.5</span> Test Cases</h3>
<p>Firstly, it is checked that the maximum number of iterations was not reached
in all these cases.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(</a>
<a class="sourceLine" id="cb56-3" data-line-number="3">      type, </a>
<a class="sourceLine" id="cb56-4" data-line-number="4">      <span class="dt">iterations =</span> purrr<span class="op">::</span><span class="kw">map_int</span>(tbl_designs<span class="op">$</span>optimal, </a>
<a class="sourceLine" id="cb56-5" data-line-number="5">                                  <span class="op">~</span>.<span class="op">$</span>nloptr_return<span class="op">$</span>iterations) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb56-6" data-line-number="6"><span class="st">  </span>{<span class="kw">print</span>(.); .} <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb56-7" data-line-number="7"><span class="st">  </span>{testthat<span class="op">::</span><span class="kw">expect_true</span>(<span class="kw">all</span>(.<span class="op">$</span>iterations <span class="op">&lt;</span><span class="st"> </span>opts<span class="op">$</span>maxeval))}</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   type             iterations
##   &lt;chr&gt;                 &lt;int&gt;
## 1 one-stage                26
## 2 group-sequential        931
## 3 two-stage              1877</code></pre>
<p>Since type one error rate is defined under the point effect size <span class="math inline">\(\delta=0\)</span>,
the type one error rate constraint can be tested for all three optimal designs.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1">tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb58-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(</a>
<a class="sourceLine" id="cb58-3" data-line-number="3">      type, </a>
<a class="sourceLine" id="cb58-4" data-line-number="4">      <span class="dt">toer =</span> purrr<span class="op">::</span><span class="kw">map</span>(tbl_designs<span class="op">$</span>optimal, </a>
<a class="sourceLine" id="cb58-5" data-line-number="5">                        <span class="op">~</span><span class="kw">sim_pr_reject</span>(.[[<span class="dv">1</span>]], <span class="fl">.0</span>, datadist)<span class="op">$</span>prob) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb58-6" data-line-number="6"><span class="st">  </span><span class="kw">unnest</span>(., <span class="dt">cols =</span> <span class="kw">c</span>(toer)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb58-7" data-line-number="7"><span class="st">  </span>{<span class="kw">print</span>(.); .} <span class="op">%&gt;%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb58-8" data-line-number="8">  testthat<span class="op">::</span><span class="kw">expect_true</span>(<span class="kw">all</span>(.<span class="op">$</span>toer <span class="op">&lt;=</span><span class="st"> </span>alpha <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>tol))) }</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   type               toer
##   &lt;chr&gt;             &lt;dbl&gt;
## 1 one-stage        0.0251
## 2 group-sequential 0.0250
## 3 two-stage        0.0249</code></pre>
<p>Since the optimal two-stage design is more flexible than the optimal
group-sequential design (constant <span class="math inline">\(n_2\)</span> function) and this is
more flexible than the optimal one-stage design (no second stage),
the expected sample sizes under the prior should be ordered in the opposite way.
Additionally, expected sample sizes under the null hypothesis
are computed both via <code>evaluate()</code> and simulation-based.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1">essh0 &lt;-<span class="st"> </span><span class="kw">ExpectedSampleSize</span>(datadist, H_<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb60-2" data-line-number="2"></a>
<a class="sourceLine" id="cb60-3" data-line-number="3">tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb60-4" data-line-number="4"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb60-5" data-line-number="5">        <span class="dt">ess       =</span> <span class="kw">map_dbl</span>(optimal,</a>
<a class="sourceLine" id="cb60-6" data-line-number="6">                            <span class="op">~</span><span class="kw">evaluate</span>(ess, .<span class="op">$</span>design) ),</a>
<a class="sourceLine" id="cb60-7" data-line-number="7">        <span class="dt">essh0     =</span> <span class="kw">map_dbl</span>(optimal,</a>
<a class="sourceLine" id="cb60-8" data-line-number="8">                            <span class="op">~</span><span class="kw">evaluate</span>(essh0, .<span class="op">$</span>design) ),</a>
<a class="sourceLine" id="cb60-9" data-line-number="9">        <span class="dt">essh0_sim =</span> <span class="kw">map_dbl</span>(optimal,</a>
<a class="sourceLine" id="cb60-10" data-line-number="10">                            <span class="op">~</span><span class="kw">sim_n</span>(.<span class="op">$</span>design, <span class="fl">.0</span>, datadist)<span class="op">$</span>n ) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb60-11" data-line-number="11"><span class="st">    </span>{<span class="kw">print</span>(.); .} <span class="op">%&gt;%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb60-12" data-line-number="12">    <span class="co"># sim/evaluate same under null?</span></a>
<a class="sourceLine" id="cb60-13" data-line-number="13">    testthat<span class="op">::</span><span class="kw">expect_equal</span>(.<span class="op">$</span>essh0, .<span class="op">$</span>essh0_sim, </a>
<a class="sourceLine" id="cb60-14" data-line-number="14">                           <span class="dt">tolerance =</span> tol_n,</a>
<a class="sourceLine" id="cb60-15" data-line-number="15">                           <span class="dt">scale =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb60-16" data-line-number="16">    <span class="co"># monotonicity with respect to degrees of freedom</span></a>
<a class="sourceLine" id="cb60-17" data-line-number="17">    testthat<span class="op">::</span><span class="kw">expect_true</span>(<span class="kw">all</span>(<span class="kw">diff</span>(.<span class="op">$</span>ess) <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)) }</a></code></pre></div>
<pre><code>## # A tibble: 3 x 6
##   type             initial    optimal      ess essh0 essh0_sim
##   &lt;chr&gt;            &lt;list&gt;     &lt;list&gt;     &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 one-stage        &lt;OnStgDsg&gt; &lt;adptrOpR&gt;  165   165       165 
## 2 group-sequential &lt;GrpSqntD&gt; &lt;adptrOpR&gt;  117.  115.      115.
## 3 two-stage        &lt;TwStgDsg&gt; &lt;adptrOpR&gt;  115.  119.      119.</code></pre>
</div>
</div>
<div id="variantII_2" class="section level2">
<h2><span class="header-section-number">3.3</span> Variant II-2: Minimizing Expected Sample Size under Null Hypothesis</h2>
<div id="objective-4" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Objective</h3>
<p>Expected sample size conditioned on negative effect sizes is minimized, i.e.,</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">ess_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">ExpectedSampleSize</span>(datadist, <span class="kw">condition</span>(prior, <span class="kw">c</span>(<span class="kw">bounds</span>(prior)[<span class="dv">1</span>], <span class="dv">0</span>)))</a></code></pre></div>
</div>
<div id="constraints-4" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Constraints</h3>
<p>No additional constraints besides type one error rate and expected power
are considered in this variant.</p>
</div>
<div id="initial-design-3" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Initial Design</h3>
<p>As in <a href="scenarioI.html#variantI_2">Variant I.2</a> another initial design is more appropriate
for optimization under the null hypothesis.
In this situation, one may expect a different (increasing) sample size function,
and thus also a different shape of the <span class="math inline">\(c_2\)</span> function.
Therefore, the <code>rpact</code> initial design is a suboptimal starting point.
Instead, we start with a constant <span class="math inline">\(c_2\)</span> function by heuristically
setting it to <span class="math inline">\(2\)</span> on the continuation area.
Since optimization under the null hypothesis favours extremely conservative
boundaries for early efficacy stopping we impose as quite liberal upper bound
of <span class="math inline">\(3\)</span> for early efficacy stopping.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1">init_design_h0 &lt;-<span class="st"> </span>tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb63-2" data-line-number="2"><span class="st">    </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;two-stage&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb63-3" data-line-number="3"><span class="st">    </span><span class="kw">pull</span>(initial) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb63-4" data-line-number="4"><span class="st">    </span>.[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb63-5" data-line-number="5">init_design_h0<span class="op">@</span>c2_pivots &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">2</span>, order)</a>
<a class="sourceLine" id="cb63-6" data-line-number="6"></a>
<a class="sourceLine" id="cb63-7" data-line-number="7">ub_design &lt;-<span class="st"> </span><span class="kw">TwoStageDesign</span>(</a>
<a class="sourceLine" id="cb63-8" data-line-number="8">    <span class="dv">3</span> <span class="op">*</span><span class="st"> </span>init_design_h0<span class="op">@</span>n1,</a>
<a class="sourceLine" id="cb63-9" data-line-number="9">    <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb63-10" data-line-number="10">    <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb63-11" data-line-number="11">    <span class="kw">rep</span>(<span class="dv">600</span>, order),</a>
<a class="sourceLine" id="cb63-12" data-line-number="12">    <span class="kw">rep</span>(<span class="fl">3.0</span>, order)</a>
<a class="sourceLine" id="cb63-13" data-line-number="13">)</a></code></pre></div>
</div>
<div id="optimization-4" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Optimization</h3>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1">opt_neg &lt;-<span class="st"> </span><span class="kw">minimize</span>(</a>
<a class="sourceLine" id="cb64-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb64-3" data-line-number="3">        ess_<span class="dv">0</span>,</a>
<a class="sourceLine" id="cb64-4" data-line-number="4">        </a>
<a class="sourceLine" id="cb64-5" data-line-number="5">        <span class="kw">subject_to</span>(</a>
<a class="sourceLine" id="cb64-6" data-line-number="6">          </a>
<a class="sourceLine" id="cb64-7" data-line-number="7">            toer_cnstr,</a>
<a class="sourceLine" id="cb64-8" data-line-number="8">            epow_cnstr</a>
<a class="sourceLine" id="cb64-9" data-line-number="9">        ),</a>
<a class="sourceLine" id="cb64-10" data-line-number="10">        </a>
<a class="sourceLine" id="cb64-11" data-line-number="11">        <span class="dt">initial_design =</span> init_design_h0,</a>
<a class="sourceLine" id="cb64-12" data-line-number="12">        <span class="dt">upper_boundary_design =</span> ub_design,</a>
<a class="sourceLine" id="cb64-13" data-line-number="13">        <span class="dt">opts =</span> opts</a>
<a class="sourceLine" id="cb64-14" data-line-number="14">)</a></code></pre></div>
</div>
<div id="test-cases-4" class="section level3">
<h3><span class="header-section-number">3.3.5</span> Test Cases</h3>
<p>First of all, check if the optimization algorithm converged.
To avoid improper solutions, it is first verified that the maximum
number of iterations was not exceeded in any of the three cases.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1">testthat<span class="op">::</span><span class="kw">expect_true</span>(opt_neg<span class="op">$</span>nloptr_return<span class="op">$</span>iterations <span class="op">&lt;</span><span class="st"> </span>opts<span class="op">$</span>maxeval)</a>
<a class="sourceLine" id="cb65-2" data-line-number="2"><span class="kw">print</span>(opt_neg<span class="op">$</span>nloptr_return<span class="op">$</span>iterations)</a></code></pre></div>
<pre><code>## [1] 7604</code></pre>
<p>Again, the type one error rate under the point null hypothesis <span class="math inline">\(\delta = 0\)</span>
can be tested by simulation.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">tbl_toer &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb67-2" data-line-number="2">  <span class="dt">toer     =</span> <span class="kw">evaluate</span>(<span class="kw">Power</span>(datadist, H_<span class="dv">0</span>), opt_neg<span class="op">$</span>design),</a>
<a class="sourceLine" id="cb67-3" data-line-number="3">  <span class="dt">toer_sim =</span> <span class="kw">sim_pr_reject</span>(opt_neg<span class="op">$</span>design, <span class="fl">.0</span>, datadist)<span class="op">$</span>prob</a>
<a class="sourceLine" id="cb67-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb67-5" data-line-number="5"></a>
<a class="sourceLine" id="cb67-6" data-line-number="6"><span class="kw">print</span>(tbl_toer)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##     toer toer_sim
##    &lt;dbl&gt;    &lt;dbl&gt;
## 1 0.0249   0.0250</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1">testthat<span class="op">::</span><span class="kw">expect_true</span>(tbl_toer<span class="op">$</span>toer <span class="op">&lt;=</span><span class="st"> </span>alpha <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>tol))</a>
<a class="sourceLine" id="cb69-2" data-line-number="2">testthat<span class="op">::</span><span class="kw">expect_true</span>(tbl_toer<span class="op">$</span>toer_sim <span class="op">&lt;=</span><span class="st"> </span>alpha <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>tol))</a></code></pre></div>
<p>Furthermore, the expected sample size under the prior conditioned on negative
effect sizes (<span class="math inline">\(\delta \leq 0\)</span>) should be lower for the optimal design derived
in this variant than for the optimal design from <a href="scenarioII.html#variantII_1">Variant II.1</a>
where expected sample size under the full prior was minimized.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1">testthat<span class="op">::</span><span class="kw">expect_lte</span>(</a>
<a class="sourceLine" id="cb70-2" data-line-number="2">    <span class="kw">evaluate</span>(ess_<span class="dv">0</span>, opt_neg<span class="op">$</span>design),</a>
<a class="sourceLine" id="cb70-3" data-line-number="3">    <span class="kw">evaluate</span>(</a>
<a class="sourceLine" id="cb70-4" data-line-number="4">        ess_<span class="dv">0</span>, </a>
<a class="sourceLine" id="cb70-5" data-line-number="5">        tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb70-6" data-line-number="6"><span class="st">            </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;two-stage&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb70-7" data-line-number="7"><span class="st">            </span><span class="kw">pull</span>(optimal) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb70-8" data-line-number="8"><span class="st">            </span>.[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb70-9" data-line-number="9"><span class="st">            </span>.<span class="op">$</span>design )</a>
<a class="sourceLine" id="cb70-10" data-line-number="10">)</a></code></pre></div>
</div>
</div>
<div id="variantII_3" class="section level2">
<h2><span class="header-section-number">3.4</span> Variant II-3: Conditional Power Constraint</h2>
<div id="objective-5" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Objective</h3>
<p>As in <a href="scenarioII.html#variantII_1">Variant II-1</a>, expected sample size under the full prior
is minimized.</p>
</div>
<div id="constraints-5" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Constraints</h3>
<p>In addition to the constraints on type one error rate and expected power,
a constraint on conditional power to be larger than <span class="math inline">\(0.7\)</span> is included.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1">cp       &lt;-<span class="st"> </span><span class="kw">ConditionalPower</span>(datadist, <span class="kw">condition</span>(prior, <span class="kw">c</span>(<span class="dv">0</span>, prior<span class="op">@</span>support[<span class="dv">2</span>])))</a>
<a class="sourceLine" id="cb71-2" data-line-number="2">cp_cnstr &lt;-<span class="st"> </span>cp <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.7</span></a></code></pre></div>
</div>
<div id="initial-design-4" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Initial Design</h3>
<p>The previous initial design can still be applied.</p>
</div>
<div id="optimization-5" class="section level3">
<h3><span class="header-section-number">3.4.4</span> Optimization</h3>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1">opt_cp &lt;-<span class="st"> </span><span class="kw">minimize</span>(</a>
<a class="sourceLine" id="cb72-2" data-line-number="2">        ess,</a>
<a class="sourceLine" id="cb72-3" data-line-number="3">        <span class="kw">subject_to</span>(</a>
<a class="sourceLine" id="cb72-4" data-line-number="4">            toer_cnstr,</a>
<a class="sourceLine" id="cb72-5" data-line-number="5">            epow_cnstr,</a>
<a class="sourceLine" id="cb72-6" data-line-number="6">            cp_cnstr</a>
<a class="sourceLine" id="cb72-7" data-line-number="7">        ),</a>
<a class="sourceLine" id="cb72-8" data-line-number="8">        <span class="dt">initial_design =</span> tbl_designs<span class="op">$</span>initial[[<span class="dv">3</span>]],</a>
<a class="sourceLine" id="cb72-9" data-line-number="9">        <span class="dt">opts =</span> opts</a>
<a class="sourceLine" id="cb72-10" data-line-number="10">)</a></code></pre></div>
</div>
<div id="test-cases-5" class="section level3">
<h3><span class="header-section-number">3.4.5</span> Test Cases</h3>
<p>We start checking whether the maximum number of iterations was not reached.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="kw">print</span>(opt_cp<span class="op">$</span>nloptr_return<span class="op">$</span>iterations)</a></code></pre></div>
<pre><code>## [1] 1842</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1">testthat<span class="op">::</span><span class="kw">expect_true</span>(opt_cp<span class="op">$</span>nloptr_return<span class="op">$</span>iterations <span class="op">&lt;</span><span class="st"> </span>opts<span class="op">$</span>maxeval)</a></code></pre></div>
<p>The type one error rate is tested via simulation and compared
to the value obtained by <code>evaluate()</code>.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1">tbl_toer &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb76-2" data-line-number="2">  <span class="dt">toer     =</span> <span class="kw">evaluate</span>(<span class="kw">Power</span>(datadist, H_<span class="dv">0</span>), opt_cp<span class="op">$</span>design),</a>
<a class="sourceLine" id="cb76-3" data-line-number="3">  <span class="dt">toer_sim =</span> <span class="kw">sim_pr_reject</span>(opt_cp<span class="op">$</span>design, <span class="fl">.0</span>, datadist)<span class="op">$</span>prob</a>
<a class="sourceLine" id="cb76-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb76-5" data-line-number="5"></a>
<a class="sourceLine" id="cb76-6" data-line-number="6"><span class="kw">print</span>(tbl_toer)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##     toer toer_sim
##    &lt;dbl&gt;    &lt;dbl&gt;
## 1 0.0250   0.0250</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1">testthat<span class="op">::</span><span class="kw">expect_true</span>(tbl_toer<span class="op">$</span>toer <span class="op">&lt;=</span><span class="st"> </span>alpha <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>tol))</a>
<a class="sourceLine" id="cb78-2" data-line-number="2">testthat<span class="op">::</span><span class="kw">expect_true</span>(tbl_toer<span class="op">$</span>toer_sim <span class="op">&lt;=</span><span class="st"> </span>alpha <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>tol))</a></code></pre></div>
<p>The conditional power is evaluated via numerical integration on several points
inside the continuation region and it is tested whether the constraint is
fulfilled on all these points.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb79-2" data-line-number="2">    <span class="dt">x1 =</span> <span class="kw">seq</span>(opt_cp<span class="op">$</span>design<span class="op">@</span>c1f, opt_cp<span class="op">$</span>design<span class="op">@</span>c1e, <span class="dt">length.out =</span> <span class="dv">25</span>),</a>
<a class="sourceLine" id="cb79-3" data-line-number="3">    <span class="dt">cp =</span> <span class="kw">map_dbl</span>(x1, <span class="op">~</span><span class="kw">evaluate</span>(cp, opt_cp<span class="op">$</span>design, .)) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb79-4" data-line-number="4"><span class="st">  </span>{<span class="kw">print</span>(.); .} <span class="op">%&gt;%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb79-5" data-line-number="5">      testthat<span class="op">::</span><span class="kw">expect_true</span>(<span class="kw">all</span>(.<span class="op">$</span>cp <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.7</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>tol))) }</a></code></pre></div>
<pre><code>## # A tibble: 25 x 2
##       x1    cp
##    &lt;dbl&gt; &lt;dbl&gt;
##  1 0.675 0.698
##  2 0.747 0.700
##  3 0.819 0.700
##  4 0.891 0.699
##  5 0.963 0.698
##  6 1.03  0.698
##  7 1.11  0.701
##  8 1.18  0.705
##  9 1.25  0.709
## 10 1.32  0.715
## # … with 15 more rows</code></pre>
<p>Due to the additional constraint in comparison to <a href="scenarioII.html#variantII_1">Variant II.1</a>,
Variant II.3 should show a larger expected sample size under the prior than
Variant II.1</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1">testthat<span class="op">::</span><span class="kw">expect_gte</span>(</a>
<a class="sourceLine" id="cb81-2" data-line-number="2">    <span class="kw">evaluate</span>(ess, opt_cp<span class="op">$</span>design),</a>
<a class="sourceLine" id="cb81-3" data-line-number="3">    <span class="kw">evaluate</span>(</a>
<a class="sourceLine" id="cb81-4" data-line-number="4">        ess, </a>
<a class="sourceLine" id="cb81-5" data-line-number="5">        tbl_designs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-6" data-line-number="6"><span class="st">            </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;two-stage&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-7" data-line-number="7"><span class="st">            </span><span class="kw">pull</span>(optimal) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-8" data-line-number="8"><span class="st">            </span>.[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-9" data-line-number="9"><span class="st">            </span>.<span class="op">$</span>design )</a>
<a class="sourceLine" id="cb81-10" data-line-number="10">)</a></code></pre></div>
</div>
</div>
<div id="plot-two-stage-designs-1" class="section level2">
<h2><span class="header-section-number">3.5</span> Plot Two-Stage Designs</h2>
<p>The optimal two-stage designs stemming from the different variants
are plotted together.</p>
<p><img src="adoptr-validation-report_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="scenarioI.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="scenarioIII.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/kkmann/adoptr-validation-report/edit/master/02-scenario-II.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["adoptr-validation-report.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
